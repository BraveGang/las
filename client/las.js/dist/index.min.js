"undefined"!=typeof window&&function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Las=t():e.Las=t()}(this,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=15)}([function(e,t,i){"use strict";t.a={MEDIA_INFO:"mediaInfo",PARSING_INIT_SEGMENT:"parsingInitSegment",PARSING_DATA:"parsingData",PARSED_DATA:"parsedData",SCRIPT_PARSED:"scriptParsed",LOAD_END:"loadEnd",DISCONTINUITY:"discontinuity",ERROR:"lasError",LEVEL_SWITCH_FAILED:"levelSwitchFailed",LEVEL_SWITCHING:"levelSwitching",LEVEL_SWITCHED:"levelSwitched",MANIFEST_PARSED:"manifestParsed",BUFFER_FLUSHING:"bufferFlushing",INIT_PTS_FOUND:"initPTSFound",FLV_HEAD:"flvHead",REPORT:"report",HEARTBEAT:"heartbeat"}},function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return r}));var r;function n(e,t){return t&&0!==t.length||(t=[e],e=""),e="kwai-k"+(e?"::"+e:""),t.unshift("["+e+"] > "),t}!function(e){e.LEVEL_ERROR="e",e.LEVEL_WARN="w",e.LEVEL_INFO="i",e.LEVEL_DEBUG="d",e.LEVEL_VERBOSE="v"}(r||(r={}));var s=function(){function e(){}return e.level=function(t){switch(e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!1,t){case r.LEVEL_WARN:e.ENABLE_ERROR=e.ENABLE_WARN=!0;break;case r.LEVEL_INFO:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=!0;break;case r.LEVEL_DEBUG:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=!0;break;case r.LEVEL_VERBOSE:e.ENABLE_ERROR=e.ENABLE_WARN=e.ENABLE_INFO=e.ENABLE_DEBUG=e.ENABLE_VERBOSE=!0;break;default:e.ENABLE_ERROR=!0}},e.e=function(t){if(e.ENABLE_ERROR){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);(console.error||console.warn||console.log).apply(console,a)}},e.w=function(t){if(e.ENABLE_WARN){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);(console.warn||console.log).apply(console,a)}},e.i=function(t){if(e.ENABLE_INFO){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);(console.info||console.log).apply(console,a)}},e.d=function(t){if(e.ENABLE_DEBUG){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);(console.debug||console.log).apply(console,a)}},e.v=function(t){if(e.ENABLE_VERBOSE){for(var i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];var a=n(t,r);console.log.apply(console,a)}},e}();s.ENABLE_ERROR=!0,s.ENABLE_WARN=!1,s.ENABLE_INFO=!1,s.ENABLE_DEBUG=!1,s.ENABLE_VERBOSE=!1},function(e,t,i){"use strict";var r,n;i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return n})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e.MSE_ERROR="mseError"}(r||(r={})),function(e){e[e.LOAD_ERROR=10]="LOAD_ERROR",e[e.VIDEO_ERROR=101]="VIDEO_ERROR",e[e.UNSUPPORTED=102]="UNSUPPORTED",e[e.CONFIG_ERROR=103]="CONFIG_ERROR",e[e.MEDIASOURCE_ERROR=200]="MEDIASOURCE_ERROR",e[e.ADDSOURCEBUFFER_ERROR=201]="ADDSOURCEBUFFER_ERROR",e[e.SOURCEBUFFER_ERROR=202]="SOURCEBUFFER_ERROR",e[e.ENDOFSTREAM_ERROR=203]="ENDOFSTREAM_ERROR",e[e.APPENDBUFFER_ERROR=204]="APPENDBUFFER_ERROR",e[e.PARSING_ERROR=301]="PARSING_ERROR",e[e.REMUX_ERROR=302]="REMUX_ERROR",e[e.REMUX_ALLOC_ERROR=303]="REMUX_ALLOC_ERROR"}(n||(n={}))},function(e,t,i){"use strict";var r;i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s})),function(e){e[e.AUDIO=8]="AUDIO",e[e.VIDEO=9]="VIDEO",e[e.SCRIPT=18]="SCRIPT"}(r||(r={}));var n={FLV_HEAD_LEN:13,FLV_TAG_HEAD_LEN:11,FLV_TAG_SIZE_LEN:4,AVC_KEY_FRAME_CHECK_LEN:2},s=function(){this.tagType=r.VIDEO,this.dataSize=0,this.timestamp=0,this.size=0,this.cts=0,this.frameType=0,this.codecId=0,this.body=null,this.fill=void 0}},function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var r=Object.assign||function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(e),r=1;r<arguments.length;r++){var n=arguments[r];if(null!=n)for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=n[s])}return i}},function(e,t,i){"use strict";var r={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],n={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},s={};if(n.browser){s[n.browser]=!0;var a=n.majorVersion.split(".");s.version={major:parseInt(n.majorVersion,10),string:n.version},a.length>1&&(s.version.minor=parseInt(a[1],10)),a.length>2&&(s.version.build=parseInt(a[2],10))}if(n.platform&&(s[n.platform]=!0),(s.chrome||s.opr||s.safari)&&(s.webkit=!0),s.rv||s.iemobile){s.rv&&delete s.rv;n.browser="msie",s.msie=!0}if(s.edge){delete s.edge;n.browser="msedge",s.msedge=!0}if(s.opr){n.browser="opera",s.opera=!0}if(s.safari&&s.android){n.browser="android",s.android=!0}for(var o in s.name=n.browser,s.platform=n.platform,r)r.hasOwnProperty(o)&&delete r[o];r=s}(),t.a=r},function(e,t,i){"use strict";var r,n="object"==typeof Reflect?Reflect:null,s=n&&"function"==typeof n.apply?n.apply:function(e,t,i){return Function.prototype.apply.call(e,t,i)};r=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function h(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function d(e,t,i,r){var n,s,a,o;if("function"!=typeof i)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof i);if(void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,i.listener?i.listener:i),s=e._events),a=s[t]),void 0===a)a=s[t]=i,++e._eventsCount;else if("function"==typeof a?a=s[t]=r?[i,a]:[a,i]:r?a.unshift(i):a.push(i),(n=h(e))>0&&a.length>n&&!a.warned){a.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=a.length,o=u,console&&console.warn&&console.warn(o)}return e}function f(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,s(this.listener,this.target,e))}function _(e,t,i){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:i},n=f.bind(r);return n.listener=i,r.wrapFn=n,n}function c(e,t,i){var r=e._events;if(void 0===r)return[];var n=r[t];return void 0===n?[]:"function"==typeof n?i?[n.listener||n]:[n]:i?function(e){for(var t=new Array(e.length),i=0;i<t.length;++i)t[i]=e[i].listener||e[i];return t}(n):p(n,n.length)}function l(e){var t=this._events;if(void 0!==t){var i=t[e];if("function"==typeof i)return 1;if(void 0!==i)return i.length}return 0}function p(e,t){for(var i=new Array(t),r=0;r<t;++r)i[r]=e[r];return i}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return h(this)},o.prototype.emit=function(e){for(var t=[],i=1;i<arguments.length;i++)t.push(arguments[i]);var r="error"===e,n=this._events;if(void 0!==n)r=r&&void 0===n.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var u=n[e];if(void 0===u)return!1;if("function"==typeof u)s(u,this,t);else{var h=u.length,d=p(u,h);for(i=0;i<h;++i)s(d[i],this,t)}return!0},o.prototype.addListener=function(e,t){return d(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return d(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.on(e,_(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);return this.prependListener(e,_(this,e,t)),this},o.prototype.removeListener=function(e,t){var i,r,n,s,a;if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t);if(void 0===(r=this._events))return this;if(void 0===(i=r[e]))return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){for(n=-1,s=i.length-1;s>=0;s--)if(i[s]===t||i[s].listener===t){a=i[s].listener,n=s;break}if(n<0)return this;0===n?i.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(i,n),1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,i,r;if(void 0===(i=this._events))return this;if(void 0===i.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==i[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete i[e]),this;if(0===arguments.length){var n,s=Object.keys(i);for(r=0;r<s.length;++r)"removeListener"!==(n=s[r])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=i[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return c(this,e,!0)},o.prototype.rawListeners=function(e){return c(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):l.call(e,t)},o.prototype.listenerCount=l,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,i){"use strict";var r=i(6);var n=function(e){var t,i;function r(){return e.apply(this,arguments)||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r.prototype.trigger=function(t){for(var i,r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];return(i=e.prototype.emit).call.apply(i,[this,t,t].concat(n))},r}(r.EventEmitter);t.a=n},function(e,t,i){"use strict";var r,n,s=i(0),a=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},o=i(4),u=i(2),h=i(5),d=i(1),f=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();!function(e){e.video="video",e.audio="audio"}(r||(r={})),function(e){e[e.video=1]="video",e[e.audio=2]="audio"}(n||(n={}));var _=Math.pow(2,32)-1,c=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],hev1:[],hvcC:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:r};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=s,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),u=new Uint8Array([104,101,118,49]),h=new Uint8Array([0,0,0,1]);e.FTYP_AVC=e.box(e.types.ftyp,a,h,a,o),e.FTYP_HEVC=e.box(e.types.ftyp,a,h,a,u),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))},e.box=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];for(var n,s=8,a=i.length,o=a;a--;)s+=i[a].byteLength;for((n=new Uint8Array(s))[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=255&s,n.set(e,4),a=0,s=8;a<o;a++)n.set(i[a],s),s+=i[a].byteLength;return n},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var r=Math.floor(i/(_+1)),n=Math.floor(i%(_+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,i))},e.moov=function(t){for(var i=t.length,r=[];i--;)r[i]=e.trak(t[i]);return e.box.apply(e,[e.types.moov].concat([e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t))))},e.mvex=function(t){for(var i=t.length,r=[];i--;)r[i]=e.trex(t[i]);return e.box.apply(e,[e.types.mvex].concat(r))},e.mvhd=function(t,i){i*=t;var r=Math.floor(i/(_+1)),n=Math.floor(i%(_+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,n>>24,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)},e.sdtp=function(t){var i,r,n=t.samples||[],s=new Uint8Array(4+n.length);for(r=0;r<n.length;r++)i=n[r].flags,s[r+4]=i.dependsOn<<4|i.isDependedOn<<2|i.hasRedundancy;return e.box(e.types.sdtp,s)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,r,n,s=[],a=[];for(i=0;i<t.sps.length;i++)n=(r=t.sps[i]).byteLength,s.push(n>>>8&255),s.push(255&n),s=s.concat(Array.prototype.slice.call(r));for(i=0;i<t.pps.length;i++)n=(r=t.pps[i]).byteLength,a.push(n>>>8&255),a.push(255&n),a=a.concat(Array.prototype.slice.call(r));var o=e.box(e.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|t.sps.length].concat(s).concat([t.pps.length]).concat(a))),u=t.width,h=t.height,d=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,h>>8&255,255&h,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,f>>24,f>>16&255,f>>8&255,255&f])))},e.hev1=function(t){var i=t.hvcc,r=t.codecWidth,n=t.codecHeight,s=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,r>>>8&255,255&r,n>>>8&255,255&n,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.hev1,s,e.box(e.types.hvcC,i))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return t.type===r.audio?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):0===t.codec.indexOf("hev1")?e.box(e.types.stsd,e.STSD,e.hev1(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,r=t.duration*t.timescale,n=Math.floor(r/(_+1)),s=Math.floor(r%(_+1)),a=0,o=0;return t.hasOwnProperty("width")&&(a=t.width),t.hasOwnProperty("height")&&(o=t.height),e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,s>>24,s>>16&255,s>>8&255,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,o>>8&255,255&o,0,0]))},e.traf=function(t,i){var r=e.sdtp(t),n=t.id,s=Math.floor(i/(_+1)),a=Math.floor(i%(_+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var r,n,s,a,o,u,h=t.samples||[],d=h.length,f=12+16*d,_=new Uint8Array(f);for(i+=8+f,_.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),r=0;r<d;r++)s=(n=h[r]).duration,a=n.size,o=n.flags,u=n.cts,_.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,a>>>24&255,a>>>16&255,a>>>8&255,255&a,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*r);return e.box(e.types.trun,_)},e.initSegment=function(t){e.types||e.init();for(var i=e.FTYP_AVC,r=t.length;r--;)"video"===t[r].type&&0===t[r].codec.indexOf("hev1")&&(i=e.FTYP_HEVC);var n=e.moov(t),s=new Uint8Array(i.byteLength+n.byteLength);return s.set(i),s.set(n,i.byteLength),s},e}();c.types=void 0,c.HDLR_TYPES=void 0,c.STTS=void 0,c.STSC=void 0,c.STCO=void 0,c.STSZ=void 0,c.VMHD=void 0,c.SMHD=void 0,c.STSD=void 0,c.FTYP_AVC=void 0,c.FTYP_HEVC=void 0,c.DINF=void 0;var l=c;function p(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(){function e(e,t,i,r){void 0===r&&(r=""),this._observer=void 0,this._config=void 0,this._typeSupported=void 0,this._isSafari=void 0,this._forceFirstIDR=void 0,this._stash=void 0,this._stashInfo=void 0,this._stashLastVideoSample=void 0,this._ISGenerated=!1,this._videoTime=void 0,this._extra=void 0,this._nextAudioPts=void 0,this._nextAvcDts=void 0,this._initPTS=void 0,this._initDTS=void 0,this._initSegment={},this._observer=e,this._config=t,this._typeSupported=i;var n=navigator.userAgent;this._isSafari=!(!(r&&r.indexOf("Apple")>-1&&n)||n.match("CriOS")),this._ISGenerated=!1,this._stash=!t.gopRemux,this._resetVideoTime(),this._stashInfo={},l.types||l.init(),this._forceFirstIDR=!(!h.a.chrome||!(h.a.version.major<50||50===h.a.version.major&&h.a.version.build<2661))}var t,i,r,n=e.prototype;return n.setStat=function(e){e&&(this._ISGenerated=e.ISGenerated,this._nextAudioPts=e.nextAudioPts,this._nextAvcDts=e.nextAvcDts,this._initPTS=e.initPTS,this._initDTS=e.initDTS,this._videoTime.nbSamples=e.videoTime.nbSamples,this._videoTime.firstDTS=e.videoTime.firstDTS,this._videoTime.sampleDuration=e.videoTime.sampleDuration,this._videoTime.vLastPTS=e.videoTime.vLastPTS,this._videoTime.aLastPTS=e.videoTime.aLastPTS,this._videoTime.endDts=e.videoTime.endDts)},n.getStat=function(){return{ISGenerated:this._ISGenerated,nextAudioPts:this._nextAudioPts,nextAvcDts:this._nextAvcDts,initPTS:this._initPTS,initDTS:this._initDTS,videoTime:{nbSamples:this._videoTime.nbSamples,firstDTS:this._videoTime.firstDTS,sampleDuration:this._videoTime.sampleDuration,vLastPTS:this._videoTime.vLastPTS,aLastPTS:this._videoTime.aLastPTS,endDts:this._videoTime.endDts}}},n.destroy=function(){},n.setExtra=function(e){this._extra=e},n.resetTimeStamp=function(e){this._initPTS=this._initDTS=e,this._resetVideoTime()},n.resetInitSegment=function(){this._ISGenerated=!1,this._initSegment={},this.resetStash()},n.getLastPTS=function(){return{video:this._videoTime.vLastPTS,audio:this._videoTime.aLastPTS}},n.flush=function(e){void 0===e&&(e=0);var t=null;if(this._stash&&this._stashLastVideoSample){var i=this._stashInfo;i.track.samples=[this._stashLastVideoSample],this._stashLastVideoSample=null,i.sequenceNumber+=1,t=this.remuxVideo(i.track,i.timeOffset,!0,e,i.accurateTimeOffset)}return this.resetStash(),t},n.resetStash=function(){this._stashLastVideoSample=null,this._stashInfo={}},n.remux=function(e,t,i,r,n,s){if(void 0===s&&(s=!1),this._ISGenerated||this.generateIS(e,t,i),!r&&t.samples.length&&(t.samples[0].pts=t.samples[0].dts),this._ISGenerated){var u=s&&this._stashLastVideoSample?1:0,h=e.samples.length,f=t.samples.length,_=i,c=i;if(h&&f)if(!r&&n){if(e.samples[0].pts-t.samples[0].pts<0){var l=Object(o.a)({},t.samples[0]);l.dts=l.pts=e.samples[0].pts,t.samples.unshift(l)}}else{var p=(e.samples[0].pts-t.samples[0].pts)/t.inputTimeScale;_+=Math.max(0,p),c+=Math.max(0,-p)}if(h){e.timescale||(d.b.w("regenerate InitSegment as audio detected"),this.generateIS(e,t,i));var v,m=this.remuxAudio(e,_,r,n);m&&(v=m.endPTS-m.startPTS),f?(t.timescale||(d.b.w("regenerate InitSegment as video detected"),this.generateIS(e,t,i)),this.remuxVideo(t,c,r,v,n,s)):this.flush(v)}else{var g=null;f?g=this.remuxVideo(t,c,r,0,n,s):u&&(g=this.flush()),g&&e.codec&&a(g.startDTS)&&a(g.endDTS)&&this.remuxEmptyAudio(e,_,r,g)}}},n.generateIS=function(e,t,i){var r,n,a=this._observer,o=e.samples,h=t.samples,f=this._typeSupported,_={},c={tracks:_},p=void 0===this._initPTS,v="audio/mp4";if(p&&(r=n=1/0),e.config&&o.length&&(e.timescale=e.samplerate,d.b.v("audio sampling rate : "+e.samplerate),e.isAAC||(f.mpeg?(v="audio/mpeg",e.codec=""):f.mp3&&(e.codec="mp3")),this._initSegment.audio=!e.isAAC&&f.mpeg?new Uint8Array:l.initSegment([e]),_.audio={container:v,codec:e.codec,metadata:{channelCount:e.channelCount,audioSampleRate:e.samplerate}},p&&(r=n=o[0].pts-e.inputTimeScale*i)),t.sps&&t.pps&&h.length){var m=t.inputTimeScale;t.timescale=m,this._initSegment.video=l.initSegment([t]),_.video={container:"video/mp4",codec:t.codec,metadata:{width:t.width,height:t.height,fps:t.fps,profile:t.profile,level:t.level,chromaFormat:t.chromaFormat}},p&&(r=Math.min(r||1/0,h[0].pts-m*i),n=Math.min(n||1/0,h[0].dts-m*i),this._observer.trigger(s.a.INIT_PTS_FOUND,{initPTS:r}))}Object.keys(_).length?(a.trigger(s.a.PARSING_INIT_SEGMENT,c),this._ISGenerated=!0,p&&(this._initPTS=r,this._initDTS=n)):a.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},n.remuxVideo=function(e,t,i,r,n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var o,h,f,_,c=e.timescale,p=e.samples,v=[],m=this._PTSNormalize,g=this._initPTS,y=p[0].streamDTS/1e3,b=p[0].key,S=this._videoTime,E=8,T=0,R=0,w=0,A=p.length;if(void 0!==g){var L=this._nextAvcDts,x=this._isSafari;if(0===A||0===e.timescale)return null;if(x&&(i=i||!!(p.length&&L&&(n&&Math.abs(t-L/c)<.1||Math.abs(p[0].pts-L-g)<c/5))),i||(L=t*c,this._resetVideoTime()),void 0!==L){p.forEach((function(e){e.pts=m(e.pts-g,L),e.dts=m(e.dts-g,L)})),p.sort((function(e,t){var i=e.dts-t.dts,r=e.pts-t.pts;return i||r||e.id-t.id}));var O=p.reduce((function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)}),0);if(O<0){d.b.w("PTS < DTS detected in video samples, shifting DTS by "+Math.round(O/90)+" ms to overcome this issue");for(var k=0;k<p.length;k++)p[k].dts+=O}this._stash&&(this._stashInfo.timeOffset=t,this._stashInfo.accurateTimeOffset=n,this._stashInfo.track=e,this._stashLastVideoSample&&(A++,p.unshift(this._stashLastVideoSample),this._stashLastVideoSample=null),p.length>1&&!a&&(this._stashLastVideoSample=p.pop(),A--));var D=p[0];w=Math.max(D.dts,0),R=Math.max(D.pts,0);var C=Math.round((w-L)/90);i&&C&&(C>1?d.b.v("AVC:"+C+" ms hole between fragments detected,filling it"):C<-1&&d.b.v("AVC:"+-C+" ms overlapping between fragments detected"),R=Math.max(R-(w-L),L),w=L,p[0].dts=w,p[0].pts=R,d.b.v("Video/PTS/DTS adjusted: "+Math.round(R/90)+"/"+Math.round(w/90)+",delta:"+C+" ms")),D=p[p.length-1],_=Math.max(D.dts,0),f=Math.max(D.pts,0,_),x&&(T=Math.round((_-w)/(p.length-1)));for(var M=0,I=0,B=0;B<A;B++){for(var P=p[B],U=P.units,F=U.length,N=0,V=0;V<F;V++)N+=U[V].data.length;I+=N,M+=F,P.length=N,P.dts=x?w+B*T:Math.max(P.dts,w),P.pts=Math.max(P.pts,P.dts)}var G=I+4*M+8;try{o=new Uint8Array(G)}catch(e){return this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating video mdat "+G}),null}var H=new DataView(o.buffer);H.setUint32(0,G),o.set(l.types.mdat,4);for(var j=0;j<A;j++){for(var z=p[j],q=z.units,W=0,Q=void 0,X=0,K=q.length;X<K;X++){var Z=q[X],Y=Z.data,J=Z.data.byteLength;H.setUint32(E,J),E+=4,o.set(Y,E),E+=J,W+=4+J}if(x)Q=Math.max(0,T*Math.round((z.pts-z.dts)/T));else{if(j<A-1)T=p[j+1].dts-z.dts;else{var $=this._config,ee=0;if(ee=this._stashLastVideoSample?this._stashLastVideoSample.dts-z.dts:e.refSampleDuration||S.sampleDuration||z.dts-p[j>0?j-1:j].dts,ee=90*Math.floor(ee/90),$.stretchShortVideoTrack&&this._nextAudioPts){var te=$.maxBufferHole,ie=Math.floor(te*c),re=(r?R+r*c:this._nextAudioPts)-z.pts;re>ie?((T=re-ee)<0&&(T=ee),d.b.v("It is approximately "+re/90+" ms to the next segment; using duration "+T/90+" ms for the last video frame.")):T=ee}else T=ee}Q=Math.round(z.pts-z.dts)}if(T<0||isNaN(T)){var ne=0;i&&p.length<2&&(ne=90*C),T=Math.max((e.refSampleDuration||S.sampleDuration)-ne,90)}v.push({size:W,duration:T,cts:Q,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:z.key?2:1,isNonSync:z.key?0:1}})}this._nextAvcDts=_+T;var se=e.dropped;if(e.dropped=0,v.length&&this._forceFirstIDR){var ae=v[0].flags;ae.dependsOn=2,ae.isNonSync=0}e.samples=v,h=l.moof(e.sequenceNumber++,w,e),e.samples=[];var oe={payload:this._mergeBoxes("video",h,o),startPTS:R/c,endPTS:(f+T)/c,startDTS:w/c,endDTS:this._nextAvcDts/c,type:"video",hasAudio:!1,hasVideo:!0,nb:v.length,dropped:se,streamDTS:y,key:b,extra:this._extra};return this._videoTime.vLastPTS=oe.endPTS,this._observer.trigger(s.a.PARSING_DATA,oe),0===S.nbSamples&&(S.firstDTS=w),S.nbSamples+=A,S.sampleDuration=Math.round((this._nextAvcDts-S.firstDTS)/S.nbSamples),S.endDts=this._nextAvcDts,oe}}},n.remuxAudio=function(e,t,i,r){if(void 0===r&&(r=!1),!e.samples.length)return null;var n,a,o,h,_,c,p=e.inputTimeScale,v=e.timescale,m=p/v,g=e.isAAC?1024:1152,y=g*m,b=this._PTSNormalize,S=this._initPTS,E=!e.isAAC&&this._typeSupported.mpeg,T=[],R=e.samples[0].streamDTS/1e3,w=E?0:8,A=e.samples,L=this._nextAudioPts,x=!1;if(void 0!==S){if(i=i||!!(A.length&&L&&(r&&Math.abs(t-L/p)<.1||Math.abs(A[0].pts-L-S)<20*y)),A.forEach((function(e){e.pts=e.dts=b(e.pts-S,t*p)})),0===(A=A.filter((function(e){return e.pts>=0}))).length)return null;if(i&&void 0!==L||(L=r?t*p:A[0].pts,x=!0),void 0!==L){if(e.isAAC)for(var O=this._config.maxAudioFramesDrift,k=0,D=L;k<A.length;){var C=A[k],M=C.pts-D,I=Math.abs(1e3*M/p);if(M<=-O*y)d.b.w("Dropping 1 audio frame @ "+(D/p).toFixed(3)+"s due to "+Math.round(I)+" ms overlap."),A.splice(k,1);else if(M>=O*y&&I<1e5&&D){var B=Math.round(M/y);d.b.w("Injecting "+B+" audio frame @ "+(D/p).toFixed(3)+"s due to "+Math.round(1e3*M/p)+" ms gap.");for(var P=0;P<B;P++){var U=Math.max(D,0);(a=f.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(d.b.v("Unable to get silent frame for given audio codec; duplicating last frame instead."),a=C.unit.subarray()),A.splice(k,0,{unit:a,pts:U,dts:U}),D+=y,k++}C.pts=C.dts=D,D+=y,k++}else Math.abs(M),C.pts=C.dts=D,D+=y,k++}for(var F=A.length,N=0;F--;)N+=A[F].unit.byteLength;for(var V=0,G=A.length;V<G;V++){var H=A[V],j=H.unit,z=H.pts;if(void 0!==c&&n)n.duration=Math.round((z-c)/m);else{var q=Math.round(1e3*(z-L)/p),W=0;if(i&&e.isAAC&&q){if(q>0&&q<1e5)W=Math.round((z-L)/y),d.b.v(q+" ms hole between AAC samples detected,filling it"),W>0&&((a=f.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(a=j.subarray()),N+=W*a.length);else if(q<-12){d.b.v("drop overlapping AAC sample, expected/parsed/delta:"+(L/p).toFixed(3)+"s/"+(z/p).toFixed(3)+"s/"+-q+"ms"),N-=j.byteLength;continue}z=L}if(_=z,!(N>0))return e.samples=[],null;N+=w;try{o=new Uint8Array(N)}catch(e){return this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:"fail allocating audio mdat "+N}),null}E||(new DataView(o.buffer).setUint32(0,N),o.set(l.types.mdat,4));for(var Q=0;Q<W;Q++)(a=f.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(d.b.v("Unable to get silent frame for given audio codec; duplicating this frame instead."),a=j.subarray()),o.set(a,w),w+=a.byteLength,n={size:a.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(n)}if(!o)return;o.set(j,w);var X=j.byteLength;w+=X,n={size:X,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(n),c=z}var K=0;if(F=T.length,n){if(F>=2&&(K=T[F-2].duration,n.duration=K),F&&"number"==typeof c&&o){n&&0===n.duration&&(n.duration=e.isAAC?1024:1152),this._nextAudioPts=L=c+m*(K||g),e.samples=T,h=E?new Uint8Array:l.moof(e.sequenceNumber++,_/m,e),e.samples=[];var Z=_/p,Y=L/p,J={payload:this._mergeBoxes("audio",h,o),startPTS:Z,endPTS:Y,startDTS:Z,endDTS:Y,type:"audio",hasAudio:!0,hasVideo:!1,nb:F,streamDTS:R,extra:this._extra};return this._videoTime.aLastPTS=J.endPTS,this._observer.trigger(s.a.PARSING_DATA,J),J}return x&&delete this._nextAudioPts,e.samples=[],null}}}},n.remuxEmptyAudio=function(e,t,i,r){if(void 0!==this._initDTS){var n=e.inputTimeScale,s=n/(e.samplerate?e.samplerate:n),a=this._nextAudioPts,o=(void 0!==a?a:r.startDTS*n)+this._initDTS,u=r.endDTS*n+this._initDTS,h=1024*s,_=Math.ceil((u-o)/h),c=f.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(d.b.w("remux empty Audio"),c){for(var l=[],p=0;p<_;p++){var v=o+p*h;l.push({unit:c,pts:v,dts:v})}e.samples=l,this.remuxAudio(e,t,i)}else d.b.d("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")}},n._PTSNormalize=function(e,t){var i;if(void 0===t)return e;for(i=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=i;return e},n._resetVideoTime=function(){this._videoTime={nbSamples:0,firstDTS:0,sampleDuration:3e3,vLastPTS:0,aLastPTS:0}},n._mergeBoxes=function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];this._initSegment[e]&&(i.unshift(this._initSegment[e]),delete this._initSegment[e]);var n=i.reduce((function(e,t){return t?e+t.byteLength:e}),0),s=new Uint8Array(n),a=0;return i.forEach((function(e){e&&(s.set(e,a),a+=e.byteLength)})),s},t=e,(i=[{key:"ISGenerated",get:function(){return this._ISGenerated}}])&&p(t.prototype,i),r&&p(t,r),e}();function m(e,t,i,r,n){if(void 0===n&&(n=""),!e.samplerate){var a=function(e,t,i){void 0===i&&(i="");var r,n,a=t.objectType,o=t.sampleingIndex,h=t.chanelConfig,f=navigator.userAgent.toLowerCase(),_=i,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return o<0||o>=c.length?(e.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!0,reason:"invalid sampling index:"+o}),null):h<0||h>=8?(e.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!0,reason:"invalid chanelConfig:"+h}),null):(d.b.v("manifest codec:"+i+",data:type:"+a+",sampleingIndex:"+o+"["+c[o]+"Hz],channelConfig:"+h),/firefox/i.test(f)?o>=6?(a=5,n=new Array(4),r=o-3):(a=2,n=new Array(2),r=o):-1!==f.indexOf("android")?(a=2,n=new Array(2),r=o):(a=5,n=new Array(4),i&&(-1!==i.indexOf("mp4a.40.29")||-1!==i.indexOf("mp4a.40.5"))||!i&&o>=6?r=o-3:((i&&-1!==i.indexOf("mp4a.40.2")&&(o>=6&&1===h||/vivaldi/i.test(f))||!i&&1===h)&&(a=2,n=new Array(2)),r=o)),n[0]=a<<3,n[0]|=(14&o)>>1,n[1]|=(1&o)<<7,n[1]|=h<<3,5===a&&(n[1]|=(14&r)>>1,n[2]=(1&r)<<7,n[2]|=8,n[3]=0),{config:n,samplerate:c[o],channelCount:h,codec:"mp4a.40."+a,manifestCodec:_})}(t,function(e,t){return{objectType:e[t+2]>>>3,sampleingIndex:(7&e[t+2])<<1|e[t+3]>>>7,chanelConfig:(120&e[t+3])>>>3}}(i,r),n);a&&(e.config=a.config,e.timescale=e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,e.isAAC=!0)}}function g(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(e){this._buffer=void 0,this._buffer_index=void 0,this._total_bytes=void 0,this._total_bits=void 0,this._current_word=void 0,this._current_word_bits_left=void 0,this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}var t,i,r,n=e.prototype;return n.destroy=function(){this._buffer=null},n._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0||!this._buffer)throw new Error("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),i=new Uint8Array(4);i.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(i.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},n.readBits=function(e){if(e>32)throw new Error("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var i=this._current_word_bits_left?this._current_word:0;i>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(r,this._current_word_bits_left),s=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,i=i<<n|s},n.readBool=function(){return 1===this.readBits(1)},n.readUByte=function(){return this.readBits(8)},n.readUShort=function(){return this.readBits(16)},n.readUInt=function(){return this.readBits(32)},n.readByte=function(){return this.readBits(8)},n._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(0!=(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},n.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},n.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},n.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},n.getBitsLeft=function(){return 8*(this._total_bytes-this._buffer_index)+this._current_word_bits_left},t=e,(i=[{key:"bytesAvailable",get:function(){return this._total_bytes-this._buffer_index}}])&&g(t.prototype,i),r&&g(t,r),e}(),b={1:"Main",2:"Main 10",3:"Main Still Picture",4:"Rext"},S={30:1,60:2,63:2.1,90:3,93:3.1,120:4,123:4.1,150:5,153:5.1,156:5.2,180:6,183:6.1,186:6.2,255:8.5},E=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,i=t.byteLength,r=new Uint8Array(i),n=0,s=0;s<i;s++)s>=2&&3===t[s]&&0===t[s-1]&&0===t[s-2]||(r[n]=t[s],n++);return new Uint8Array(r.buffer,0,n)},e.parseHEVCSPS=function(t){var i=e._ebsp2rbsp(t),r=new y(i),n={general_ptl:{},sub_layer_ptl:{}};r.readBits(16),r.readBits(4);var s=r.readBits(3)+1;if(r.readBits(1),!e._parsePTL(r,n,s))return null;if(r.readUEG()>=16)return null;var a=r.readUEG();3==a&&(r.readBits(1)&&(a=0));var o=r.readUEG(),u=r.readUEG();return r.destroy(),r=null,{chroma_format_string:3===a?"4:4:4":"4:2:0",profile_string:n.general_ptl.profile_string,level_string:n.general_ptl.level_string,width:o,height:u}},e._parsePTL=function(e,t,i){if(!this._decodeProfileTierLevel(e,t.general_ptl)||e.getBitsLeft()<8+16*(i-1>0?1:0))return!1;t.general_ptl.level_idc=e.readBits(8),t.general_ptl.level_string=this.getHEVCLevelString(t.general_ptl.level_idc),t.sub_layer_profile_present_flag=[],t.sub_layer_level_present_flag=[];for(var r=0;r<i-1;r++)t.sub_layer_profile_present_flag[r]=e.readBits(1),t.sub_layer_level_present_flag[r]=e.readBits(1);if(i-1>0)for(var n=i-1;n<8;n++)e.readBits(2);for(var s=0;s<i-1;s++){if(t.sub_layer_profile_present_flag[s]&&this._decodeProfileTierLevel(e,t.sub_layer_ptl))return!1;if(t.sub_layer_level_present_flag[s]){if(e.getBitsLeft()<8)return!1;t.sub_layer_ptl[s].level_idc=e.readBits(8)}}return!0},e._decodeProfileTierLevel=function(e,t){if(e.getBitsLeft()<88)return!1;t.profile_space=e.readBits(2),t.tier_flag=e.readBits(1),t.profile_idc=e.readBits(5),t.profile_compatibility_flag=[];for(var i=0;i<32;i++)t.profile_compatibility_flag[i]=e.readBits(1),0==t.profile_idc&&i>0&&t.profile_compatibility_flag[i]&&(t.profile_idc=i);return t.progressive_source_flag=e.readBits(1),t.interlaced_source_flag=e.readBits(1),t.non_packed_constraint_flag=e.readBits(1),t.frame_only_constraint_flag=e.readBits(1),e.readBits(16),e.readBits(16),e.readBits(12),t.profile_string=this.getHEVCProfileString(t.profile_idc),!0},e.parseSPS=function(t){var i=e._ebsp2rbsp(t),r=new y(i);r.readByte();var n=r.readByte();r.readByte();var s=r.readByte();r.readUEG();var a=e.getProfileString(n),o=e.getLevelString(s),u=1,h=420,d=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(u=r.readUEG())&&r.readBits(1),u<=3&&(h=[0,420,422,444][u]),d=r.readUEG()+8,r.readUEG(),r.readBits(1),r.readBool()))for(var f=3!==u?8:12,_=0;_<f;_++)r.readBool()&&(_<6?e._skipScalingList(r,16):e._skipScalingList(r,64));r.readUEG();var c=r.readUEG();if(0===c)r.readUEG();else if(1===c){r.readBits(1),r.readSEG(),r.readSEG();for(var l=r.readUEG(),p=0;p<l;p++)r.readSEG()}r.readUEG(),r.readBits(1);var v=r.readUEG(),m=r.readUEG(),g=r.readBits(1);0===g&&r.readBits(1),r.readBits(1);var b=0,S=0,E=0,T=0;r.readBool()&&(b=r.readUEG(),S=r.readUEG(),E=r.readUEG(),T=r.readUEG());var R=1,w=1,A=0,L=!0,x=0,O=0;if(r.readBool()){if(r.readBool()){var k=r.readByte();k>0&&k<16?(R=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][k-1],w=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][k-1]):255===k&&(R=r.readByte()<<8|r.readByte(),w=r.readByte()<<8|r.readByte())}if(r.readBool()&&r.readBool(),r.readBool()&&(r.readBits(4),r.readBool()&&r.readBits(24)),r.readBool()&&(r.readUEG(),r.readUEG()),r.readBool()){var D=r.readBits(32),C=r.readBits(32);L=r.readBool(),A=(x=C)/(O=2*D)}}var M=1;1===R&&1===w||(M=R/w);var I=0,B=0;0===u?(I=1,B=2-g):(I=3===u?1:2,B=(1===u?2:1)*(2-g));var P=16*(v+1),U=16*(m+1)*(2-g);P-=(b+S)*I,U-=(E+T)*B;var F=Math.ceil(P*M);return r.destroy(),r=null,{profile_string:a,level_string:o,bit_depth:d,chroma_format:h,chroma_format_string:e.getChromaFormatString(h),frame_rate:{fixed:L,fps:A,fps_den:O,fps_num:x},sar_ratio:{width:R,height:w},codec_size:{width:P,height:U},present_size:{width:F,height:U}}},e._skipScalingList=function(e,t){for(var i=8,r=8,n=0;n<t;n++)0!==r&&(r=(i+e.readSEG()+256)%256),i=0===r?i:r},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e.getHEVCProfileString=function(e){return b[e]},e.getHEVCLevelString=function(e){return S[e]},e}();function T(e,t,i){var r=e;if(t+i<r.length){for(;i--;)if(128!=(192&r[++t]))return!1;return!0}return!1}var R=function(e){for(var t=[],i=e,r=0,n=e.length;r<n;)if(i[r]<128)t.push(String.fromCharCode(i[r])),++r;else{if(i[r]<192);else if(i[r]<224){if(T(i,r,1)){var s=(31&i[r])<<6|63&i[r+1];if(s>=128){t.push(String.fromCharCode(65535&s)),r+=2;continue}}}else if(i[r]<240){if(T(i,r,2)){var a=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2];if(a>=2048&&55296!=(63488&a)){t.push(String.fromCharCode(65535&a)),r+=3;continue}}}else if(i[r]<248&&T(i,r,3)){var o=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3];if(o>65536&&o<1114112){o-=65536,t.push(String.fromCharCode(o>>>10|55296)),t.push(String.fromCharCode(1023&o|56320)),r+=4;continue}}t.push(String.fromCharCode(65533)),++r}return t.join("")},w=function(){function e(){}return e.parseMetadata=function(t){var i={};try{var r=e.parseScript(t,0),n=e.parseScript(t,r.size);i[r.data]=n.data}catch(e){d.b.e("AMF",e.toString())}return i},e.parseObject=function(t,i){var r=e.parseString(t,i),n=e.parseScript(t,i+r.size),s=n.objectEnd;return{data:{name:r.data,value:n.data},size:n.size,objectEnd:s}},e.parseVariable=function(t,i){return e.parseObject(t,i)},e.parseLongString=function(e,t){var i=new DataView(e,t).getUint32(0);return{data:i>0?R(new Uint8Array(e,t+4,i)):"",size:4+i}},e.parseDate=function(e,t){var i=new DataView(e,t),r=i.getFloat64(0),n=i.getInt16(8);return{data:new Date(r+=60*n*1e3),size:10}},e.parseString=function(e,t){var i=new DataView(e,t).getUint16(0);return{data:i>0?R(new Uint8Array(e,t+2,i)):"",size:2+i}},e.parseScript=function(t,i){var r=t.byteLength,n=i,s=t,a=new DataView(s,0),o=null,u=a.getUint8(n);n+=1;var h=!1;switch(u){case 0:o=a.getFloat64(n),n+=8;break;case 1:o=!!a.getUint8(n),n+=1;break;case 2:var f=e.parseString(s,n);o=f.data,n+=f.size;break;case 3:o={};for(9==(16777215&a.getUint32(r-4))&&3;n<r-4;){var _=e.parseObject(s,n);if(_.objectEnd)break;o[_.data.name]=_.data.value,n=_.size}if(n<=r-3)9===(16777215&a.getUint32(n-1))&&(n+=3);break;case 8:o={},n+=4;for(9==(16777215&a.getUint32(r-4))&&3;n<r-8;){var c=e.parseVariable(s,n);if(c.objectEnd)break;o[c.data.name]=c.data.value,n=c.size}if(n<=r-3)9===(16777215&a.getUint32(n-1))&&(n+=3);break;case 9:o=void 0,n=1,h=!0;break;case 10:o=[];var l=a.getUint32(n);n+=4;for(var p=0;p<l;p++){var v=e.parseScript(s,n);o.push(v.data),n=v.size}break;case 11:var m=e.parseDate(s,n+1);o=m.data,n+=m.size;break;case 12:var g=e.parseString(s,n+1);o=g.data,n+=g.size;break;default:n=r,d.b.v("AMF","AMF","Unsupported AMF value type "+u)}return{data:o,size:n,objectEnd:h}},e}(),A=i(3),L=new Uint8Array([23,0,0,0,0,1,100,0,10,255,225,0,24,103,100,0,10,172,114,4,68,122,16,0,0,3,0,16,0,0,3,3,32,241,34,88,70,1,0,6,104,232,67,143,44,139]),x=new Uint8Array([23,1,0,0,0,0,0,2,176,6,5,255,255,172,220,69,233,189,230,217,72,183,150,44,216,32,217,35,238,239,120,50,54,52,32,45,32,99,111,114,101,32,49,53,50,32,114,50,56,53,52,32,101,57,97,53,57,48,51,32,45,32,72,46,50,54,52,47,77,80,69,71,45,52,32,65,86,67,32,99,111,100,101,99,32,45,32,67,111,112,121,108,101,102,116,32,50,48,48,51,45,50,48,49,55,32,45,32,104,116,116,112,58,47,47,119,119,119,46,118,105,100,101,111,108,97,110,46,111,114,103,47,120,50,54,52,46,104,116,109,108,32,45,32,111,112,116,105,111,110,115,58,32,99,97,98,97,99,61,49,32,114,101,102,61,49,54,32,100,101,98,108,111,99,107,61,49,58,48,58,48,32,97,110,97,108,121,115,101,61,48,120,51,58,48,120,49,51,51,32,109,101,61,117,109,104,32,115,117,98,109,101,61,49,48,32,112,115,121,61,49,32,112,115,121,95,114,100,61,49,46,48,48,58,48,46,48,48,32,109,105,120,101,100,95,114,101,102,61,49,32,109,101,95,114,97,110,103,101,61,50,52,32,99,104,114,111,109,97,95,109,101,61,49,32,116,114,101,108,108,105,115,61,50,32,56,120,56,100,99,116,61,49,32,99,113,109,61,48,32,100,101,97,100,122,111,110,101,61,50,49,44,49,49,32,102,97,115,116,95,112,115,107,105,112,61,49,32,99,104,114,111,109,97,95,113,112,95,111,102,102,115,101,116,61,45,50,32,116,104,114,101,97,100,115,61,49,32,108,111,111,107,97,104,101,97,100,95,116,104,114,101,97,100,115,61,49,32,115,108,105,99,101,100,95,116,104,114,101,97,100,115,61,48,32,110,114,61,48,32,100,101,99,105,109,97,116,101,61,49,32,105,110,116,101,114,108,97,99,101,100,61,48,32,98,108,117,114,97,121,95,99,111,109,112,97,116,61,48,32,99,111,110,115,116,114,97,105,110,101,100,95,105,110,116,114,97,61,48,32,98,102,114,97,109,101,115,61,56,32,98,95,112,121,114,97,109,105,100,61,50,32,98,95,97,100,97,112,116,61,50,32,98,95,98,105,97,115,61,48,32,100,105,114,101,99,116,61,51,32,119,101,105,103,104,116,98,61,49,32,111,112,101,110,95,103,111,112,61,48,32,119,101,105,103,104,116,112,61,50,32,107,101,121,105,110,116,61,50,53,48,32,107,101,121,105,110,116,95,109,105,110,61,50,53,32,115,99,101,110,101,99,117,116,61,52,48,32,105,110,116,114,97,95,114,101,102,114,101,115,104,61,48,32,114,99,95,108,111,111,107,97,104,101,97,100,61,54,48,32,114,99,61,99,114,102,32,109,98,116,114,101,101,61,49,32,99,114,102,61,50,51,46,48,32,113,99,111,109,112,61,48,46,54,48,32,113,112,109,105,110,61,48,32,113,112,109,97,120,61,54,57,32,113,112,115,116,101,112,61,52,32,105,112,95,114,97,116,105,111,61,49,46,52,48,32,97,113,61,49,58,49,46,48,48,0,128,0,0,0,29,101,136,129,0,5,127,254,246,115,124,10,107,109,176,149,46,5,118,246,150,55,45,60,239,89,160,124,49,129]),O=function(){function e(){}return e.getFlvVideoTag=function(e,t){void 0===t&&(t=!1);var i=new A.b;return i.tagType=A.c.VIDEO,i.body=t?L:x,i.dataSize=i.body.byteLength,i.timestamp=Math.round(e),i.frameType=1,i.codecId=7,i.fill=!0,i},e}();function k(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(){function e(e,t,i){this.tag="FlvDemux",this._observer=void 0,this._remuxer=void 0,this._config=void 0,this._duration=void 0,this._naluLengthSize=void 0,this._hasVideo=void 0,this._hasAudio=void 0,this._videoTrack=void 0,this._audioTrack=void 0,this._remuxStat=void 0,this._currentTimestamp=0,this._aLastDTS=0,this._vLastDTS=0,this._nonMonotonousCache=void 0,this._fillAtStart={enabled:!0,start:0,avcConfig:!0},this._observer=e,this._remuxer=t,this._config=i,this._duration=0,this._naluLengthSize=4,this._hasVideo=!0,this._hasAudio=!0,this._videoTrack={id:1,type:r.video,container:"",codec:"",timescale:9e4,duration:1/0,samples:[],inputTimeScale:9e4,sequenceNumber:0,pid:-1,width:0,height:0,codecWidth:0,codecHeight:0,sps:[],pps:[],pixelRatio:[],profile:"",level:"",chromaFormat:"",fps:0,dropped:0,refSampleDuration:0},this._audioTrack={id:2,type:r.audio,container:"",codec:"",timescale:9e4,duration:1/0,samples:[],inputTimeScale:9e4,sequenceNumber:0,pid:-1,isAAC:!0,samplerate:0,channelCount:0,config:[]}}var t,i,n,a=e.prototype;return a.append=function(e,t,i,r){var n=this;if(this._remuxStat||(this._remuxStat={timeOffset:t,contiguous:i,accurateTimeOffset:r}),e.length){if(e.forEach((function(e){e.tagType===A.c.VIDEO&&n._hasVideo&&(n._fillAtStart.enabled&&(n._fillAtStart.enabled=!1,n._audioTrack.samples.length&&n._fillFrame(n._audioTrack.samples[n._audioTrack.samples.length-1].dts/90)),n._parseVideoData(e)),e.tagType===A.c.AUDIO&&n._hasAudio&&n._parseAudioData(e),e.tagType===A.c.SCRIPT&&n._parseScriptTag(e)})),this._fillAtStart.enabled&&this._audioTrack.samples.length){var s=this._audioTrack.samples[0].dts/90,a=this._audioTrack.samples[this._audioTrack.samples.length-1].dts/90;this._fillAtStart.start<=0&&(this._fillAtStart.start=s),a>this._fillAtStart.start&&this._fillFrame(a)}this._remux()}},a.flvHead=function(e,t){this._hasAudio=e,this._hasVideo=t,this._fillAtStart.enabled=this._hasVideo},a.destroy=function(){},a.flush=function(){this._remux(!0),this._remuxStat=void 0},a.resetInitSegment=function(){this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=0,this._remuxStat=void 0},a.resetTimeStamp=function(){},a._parseScriptTag=function(e){if(e.body){var t=w.parseMetadata(e.body.buffer);if(t.timestamp=this._currentTimestamp||0,t.hasOwnProperty("onMetaData")){var i=t.onMetaData;"number"==typeof i.framerate&&(this._videoTrack.fps=this._videoTrack.fps||i.framerate),d.b.i(this.tag,"Parsed onMetaData")}this._observer.trigger(s.a.SCRIPT_PARSED,t)}},a._parseVideoData=function(e){if(e.body){var t=e.body[0];e.frameType=(240&t)>>>4;var i=15&t;if(7===i||12===i){e.codecId=i;var r=e.body[1];if(e.cts=((255&e.body[2])<<16)+((255&e.body[3])<<8)+(255&e.body[4]),0===r)7===i&&this._parseAVCDecoderConfigurationRecord(e,5);else if(1===r)this._parseAVCVideoData(e,5);else if(2!==r)return void this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid video packet type "+r})}else this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!0,reason:"Flv: Unsupported codec in video frame: "+i})}},a._parseAVCDecoderConfigurationRecord=function(e,t){if(e.body){var i=this._videoTrack,r=e.body.buffer,n=e.body.byteLength-t,a=new DataView(r,t,n),o=a.getUint8(0),h=a.getUint8(1);if(1===o&&0!==h)if(this._naluLengthSize=1+(3&a.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var f=31&a.getUint8(5);if(0===f||f>1)this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid H264 SPS count: "+f});else{for(var _=6,c=[],l=0;l<f;l++){var p=a.getUint16(_);if(_+=2,0!==p){var v=new Uint8Array(r,t+_,p);_+=p,c.push(v);for(var m=E.parseSPS(v),g=v.subarray(1,4),y="avc1.",b=0;b<3;b++){var S=g[b].toString(16);S.length<2&&(S="0"+S),y+=S}!i.codec||i.width===m.codec_size.width&&i.height===m.codec_size.height&&y===i.codec||(e.fill||this._remux(!0),this._remuxer.ISGenerated&&this._remuxer.resetInitSegment()),i.sps=c,i.width=m.codec_size.width,i.height=m.codec_size.height,i.pixelRatio=[m.sar_ratio.width,m.sar_ratio.height],m.frame_rate.fixed&&0!==m.frame_rate.fps&&(i.fps=m.frame_rate.fps),i.codec=y,i.profile=m.profile_string,i.level=m.level_string,i.chromaFormat=m.chroma_format_string}}var T=a.getUint8(_);if(0===T||T>1)this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid H264 PPS count: "+T});else{_++,i.pps=[];for(var R=0;R<T;R++){var w=a.getUint16(_);_+=2;var A=new Uint8Array(r,t+_,w);i.pps.push(A),0!==w&&(_+=w)}d.b.v(this.tag,"Parsed AVCDecoderConfigurationRecord"),i.duration=this._duration,i.container="video/mp4",i.fps?i.refSampleDuration=Math.floor(i.timescale/i.fps):i.refSampleDuration=Math.floor(i.timescale/30)}}}else this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!0,reason:"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1)});else this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.PARSING_ERROR,fatal:!0,reason:"Flv: Invalid AVCDecoderConfigurationRecord"})}},a._parseAVCVideoData=function(e,t,i){if(void 0===i&&(i=!1),e.body){var n=e.body.buffer,s=e.body.byteLength-t,a=new DataView(n,t,s),o=[],u=0,h=0,f=this._naluLengthSize,_=e.timestamp,c=1===e.frameType;if(!i&&_<=this._vLastDTS&&this._vLastDTS>0)return d.b.w(this.tag,"debug Non-monotonous DTS dts:"+_+" last:"+this._vLastDTS),void this._onNonMonotonous({tag:e,dataOffset:t},r.video);!i&&this._nonMonotonousCache&&this._flushNonMonotonousCache();for(var l=_+e.cts;h<s;){if(h+4>=s){d.b.v(this.tag,"Malformed Nalu near timestamp "+_+", offset = "+h+", dataSize = "+s);break}var p=a.getUint32(h);if(3===f&&(p>>>=8),p>s-f)return void d.b.v(this.tag,"Malformed Nalus near timestamp "+_+", NaluSize > DataSize!");var v=new Uint8Array(n,t+h+4,f+p-4),m=void 0;7===e.codecId&&5===(m=31&a.getUint8(h+f))&&(c=!0);var g={type:m,data:v};o.push(g),u+=v.byteLength,h+=f+p}if(o.length){var y=this._videoTrack,b={units:o,length:u,dts:90*_,cts:90*e.cts,pts:90*l,streamDTS:_,key:c};y.samples.push(b)}this._vLastDTS=_}},a._parseAudioData=function(e,t){var i;if(void 0===t&&(t=!1),e.body)if(e.body.byteLength<=1)d.b.v(this.tag,"Flv: Invalid audio packet, missing SoundData payload!");else{var n=this._audioTrack,s=e.body[1];if(0===s){if(e.body.byteLength<4)return;return m(n,this._observer,e.body,0,this._config.audioCodec),void(n.duration=this._duration)}if(1===s){var a=e.body.subarray(2),o=e.timestamp,u=(i=1024e3/n.samplerate)*this._config.maxAudioFramesDrift;if(this._aLastDTS>0){o=this._aLastDTS+i;var h=e.timestamp-o;if(!t&&h<-u)return void this._onNonMonotonous({tag:e},r.audio)}!t&&this._nonMonotonousCache&&this._flushNonMonotonousCache();var f=o*n.inputTimeScale/1e3,_={unit:a,dts:f,pts:f,streamDTS:e.timestamp,length:a.byteLength};this._aLastDTS=o,n.samples.push(_)}else d.b.v(this.tag,"Flv: Unsupported AAC data type "+s)}},a._onNonMonotonous=function(e,t){this._nonMonotonousCache||(this._nonMonotonousCache={video:[],audio:[]});var i=this._nonMonotonousCache[t];if(i.length>10){this.flush();var r=this._remuxer.getLastPTS(),n=r.audio;(0===n||r.video>0&&r.video<n)&&(n=r.video),this._videoTrack.samples=[],this._audioTrack.samples=[],this._aLastDTS=this._vLastDTS=0,this._remuxStat={accurateTimeOffset:!1,contiguous:!1,timeOffset:n},this._remuxer.resetInitSegment(),this._remuxer.resetTimeStamp(),d.b.i(this.tag,"NON_MONOTONOUS reset time"),this._flushNonMonotonousCache()}else i.push(e)},a._flushNonMonotonousCache=function(){if(this._nonMonotonousCache){var e=this._nonMonotonousCache;for(var t in e)for(var i=e[t];i.length;){var r=i.shift();r&&("video"===t?this._parseAVCVideoData(r.tag,r.dataOffset,!0):"audio"===t&&this._parseAudioData(r.tag,!0))}this._nonMonotonousCache=void 0}},a._remux=function(e){void 0===e&&(e=!1);var t=this._audioTrack,i=this._videoTrack,r=!0,n=0,a=!1;if(this._remuxStat&&(r=this._remuxStat.contiguous,n=this._remuxStat.timeOffset,a=this._remuxStat.accurateTimeOffset),0!==t.samples.length||0!==i.samples.length){if(e||!(this._hasAudio&&0===t.samples.length||this._hasVideo&&i.samples.length<2))try{this._remuxer.remux(t,i,n,r,a,e),this._remuxStat=void 0}catch(e){d.b.e(this.tag,e),this._observer.trigger(s.a.ERROR,{type:u.b.MUX_ERROR,details:u.a.REMUX_ERROR,fatal:!0,reason:e.message})}}else e&&this._remuxer.flush()},a._fillFrame=function(e){var t=this;if(0!==this._audioTrack.samples.length){var i=this._fillAtStart.start||90*this._audioTrack.samples[0].dts;if(e>i){d.b.i(this.tag,"fill video frame: "+i+" "+e),this._fillAtStart.start=e;var r=[O.getFlvVideoTag(i),O.getFlvVideoTag(e-1)];this._fillAtStart.avcConfig&&(r.unshift(O.getFlvVideoTag(i,!0)),this._fillAtStart.avcConfig=!1),r.forEach((function(e){t._parseVideoData(e)}))}}},t=e,(i=[{key:"duration",set:function(e){this._duration=e}}])&&k(t.prototype,i),n&&k(t,n),e}(),C=function(){function e(e,t,i,r){this.tag="Flv",this._observer=void 0,this._config=void 0,this._extraData=void 0,this._demuxer=void 0,this._remuxer=void 0,this._bitrate=void 0,this._vendor=void 0,this._observer=e,this._config=t,this._bitrate=this._config.bitrate,this._extraData=i,this._vendor=r}var t=e.prototype;return t.init=function(){var e=this._config,t=this._observer,i=this._remuxer=new v(t,e,{mp4:!0,mpeg:!1,mp3:!1}),r=this._demuxer=new D(t,i,e);i.setExtra(this._extraData),r.duration=e.duration||0},t.flvHead=function(e,t){this._demuxer.flvHead(e,t)},t.append=function(e,t,i,r,n){i&&(this._demuxer.resetInitSegment(),this._remuxer.resetInitSegment(),this._demuxer.resetTimeStamp(),this._remuxer.resetTimeStamp()),this._demuxer.append(e,t,r,n)},t.end=function(){this._demuxer.flush(),this._remuxer.flush(),this._observer.trigger(s.a.LOAD_END)},t.flush=function(){this._demuxer&&this._demuxer.flush()},t.setExtra=function(e){this._extraData=e,this._extraData.bitrate=this._bitrate,this._remuxer&&this._remuxer.setExtra(this._extraData)},t.destroy=function(){},e}();t.a=C},function(e,t,i){function r(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.i=function(e){return e},i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var r=i(i.s=ENTRY_MODULE);return r.default||r}var n="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(e,t,r){var a={};a[r]=[];var o=t.toString(),u=o.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return a;for(var h,d=u[1],f=new RegExp("(\\\\n|\\W)"+s(d)+n,"g");h=f.exec(o);)"dll-reference"!==h[3]&&a[r].push(h[3]);for(f=new RegExp("\\("+s(d)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+n,"g");h=f.exec(o);)e[h[2]]||(a[r].push(h[1]),e[h[2]]=i(h[1]).m),a[h[2]]=a[h[2]]||[],a[h[2]].push(h[4]);for(var _,c=Object.keys(a),l=0;l<c.length;l++)for(var p=0;p<a[c[l]].length;p++)_=a[c[l]][p],isNaN(1*_)||(a[c[l]][p]=1*a[c[l]][p]);return a}function o(e){return Object.keys(e).reduce((function(t,i){return t||e[i].length>0}),!1)}e.exports=function(e,t){t=t||{};var n={main:i.m},s=t.all?{main:Object.keys(n.main)}:function(e,t){for(var i={main:[t]},r={main:[]},n={main:{}};o(i);)for(var s=Object.keys(i),u=0;u<s.length;u++){var h=s[u],d=i[h].pop();if(n[h]=n[h]||{},!n[h][d]&&e[h][d]){n[h][d]=!0,r[h]=r[h]||[],r[h].push(d);for(var f=a(e,e[h][d],h),_=Object.keys(f),c=0;c<_.length;c++)i[_[c]]=i[_[c]]||[],i[_[c]]=i[_[c]].concat(f[_[c]])}}return r}(n,e),u="";Object.keys(s).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;s[e][t];)t++;s[e].push(t),n[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",u=u+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s[e].map((function(t){return JSON.stringify(t)+": "+n[e][t].toString()})).join(",")+"});\n"})),u=u+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s.main.map((function(e){return JSON.stringify(e)+": "+n.main[e].toString()})).join(",")+"}))(self);";var h=new window.Blob([u],{type:"text/javascript"});if(t.bare)return h;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(h),f=new window.Worker(d);return f.objectURL=d,f}},function(e,t,i){"use strict";(function(t){var r=i(12),n=i(13),s=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,a=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\S\s]*)/i,o=new RegExp("^[\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\\u2029\\uFEFF]+");function u(e){return(e||"").toString().replace(o,"")}var h=[["#","hash"],["?","query"],function(e){return e.replace("\\","/")},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d+)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],d={hash:1,query:1};function f(e){var i,r=("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{}).location||{},n={},a=typeof(e=e||r);if("blob:"===e.protocol)n=new c(unescape(e.pathname),{});else if("string"===a)for(i in n=new c(e,{}),d)delete n[i];else if("object"===a){for(i in e)i in d||(n[i]=e[i]);void 0===n.slashes&&(n.slashes=s.test(e.href))}return n}function _(e){e=u(e);var t=a.exec(e);return{protocol:t[1]?t[1].toLowerCase():"",slashes:!!t[2],rest:t[3]}}function c(e,t,i){if(e=u(e),!(this instanceof c))return new c(e,t,i);var s,a,o,d,l,p,v=h.slice(),m=typeof t,g=this,y=0;for("object"!==m&&"string"!==m&&(i=t,t=null),i&&"function"!=typeof i&&(i=n.parse),t=f(t),s=!(a=_(e||"")).protocol&&!a.slashes,g.slashes=a.slashes||s&&t.slashes,g.protocol=a.protocol||t.protocol||"",e=a.rest,a.slashes||(v[3]=[/(.*)/,"pathname"]);y<v.length;y++)"function"!=typeof(d=v[y])?(o=d[0],p=d[1],o!=o?g[p]=e:"string"==typeof o?~(l=e.indexOf(o))&&("number"==typeof d[2]?(g[p]=e.slice(0,l),e=e.slice(l+d[2])):(g[p]=e.slice(l),e=e.slice(0,l))):(l=o.exec(e))&&(g[p]=l[1],e=e.slice(0,l.index)),g[p]=g[p]||s&&d[3]&&t[p]||"",d[4]&&(g[p]=g[p].toLowerCase())):e=d(e);i&&(g.query=i(g.query)),s&&t.slashes&&"/"!==g.pathname.charAt(0)&&(""!==g.pathname||""!==t.pathname)&&(g.pathname=function(e,t){if(""===e)return t;for(var i=(t||"/").split("/").slice(0,-1).concat(e.split("/")),r=i.length,n=i[r-1],s=!1,a=0;r--;)"."===i[r]?i.splice(r,1):".."===i[r]?(i.splice(r,1),a++):a&&(0===r&&(s=!0),i.splice(r,1),a--);return s&&i.unshift(""),"."!==n&&".."!==n||i.push(""),i.join("/")}(g.pathname,t.pathname)),r(g.port,g.protocol)||(g.host=g.hostname,g.port=""),g.username=g.password="",g.auth&&(d=g.auth.split(":"),g.username=d[0]||"",g.password=d[1]||""),g.origin=g.protocol&&g.host&&"file:"!==g.protocol?g.protocol+"//"+g.host:"null",g.href=g.toString()}c.prototype={set:function(e,t,i){var s=this;switch(e){case"query":"string"==typeof t&&t.length&&(t=(i||n.parse)(t)),s[e]=t;break;case"port":s[e]=t,r(t,s.protocol)?t&&(s.host=s.hostname+":"+t):(s.host=s.hostname,s[e]="");break;case"hostname":s[e]=t,s.port&&(t+=":"+s.port),s.host=t;break;case"host":s[e]=t,/:\d+$/.test(t)?(t=t.split(":"),s.port=t.pop(),s.hostname=t.join(":")):(s.hostname=t,s.port="");break;case"protocol":s.protocol=t.toLowerCase(),s.slashes=!i;break;case"pathname":case"hash":if(t){var a="pathname"===e?"/":"#";s[e]=t.charAt(0)!==a?a+t:t}else s[e]=t;break;default:s[e]=t}for(var o=0;o<h.length;o++){var u=h[o];u[4]&&(s[u[1]]=s[u[1]].toLowerCase())}return s.origin=s.protocol&&s.host&&"file:"!==s.protocol?s.protocol+"//"+s.host:"null",s.href=s.toString(),s},toString:function(e){e&&"function"==typeof e||(e=n.stringify);var t,i=this,r=i.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var s=r+(i.slashes?"//":"");return i.username&&(s+=i.username,i.password&&(s+=":"+i.password),s+="@"),s+=i.host+i.pathname,(t="object"==typeof i.query?e(i.query):i.query)&&(s+="?"!==t.charAt(0)?"?"+t:t),i.hash&&(s+=i.hash),s}},c.extractProtocol=_,c.location=f,c.trimLeft=u,c.qs=n,e.exports=c}).call(this,i(11))},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";e.exports=function(e,t){if(t=t.split(":")[0],!(e=+e))return!1;switch(t){case"http":case"ws":return 80!==e;case"https":case"wss":return 443!==e;case"ftp":return 21!==e;case"gopher":return 70!==e;case"file":return!1}return 0!==e}},function(e,t,i){"use strict";var r=Object.prototype.hasOwnProperty;function n(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(e){return null}}t.stringify=function(e,t){t=t||"";var i,n,s=[];for(n in"string"!=typeof t&&(t="?"),e)if(r.call(e,n)){if((i=e[n])||null!=i&&!isNaN(i)||(i=""),n=encodeURIComponent(n),i=encodeURIComponent(i),null===n||null===i)continue;s.push(n+"="+i)}return s.length?t+s.join("&"):""},t.parse=function(e){for(var t,i=/([^=?&]+)=?([^&]*)/g,r={};t=i.exec(e);){var s=n(t[1]),a=n(t[2]);null===s||null===a||s in r||(r[s]=a)}return r}},function(e,t,i){"use strict";i.r(t);var r=i(7),n=i(0),s=i(8),a=i(1);t.default=function(e){var t,i=new r.a,o=function(t,i){e.postMessage({event:t,data:i})};i.on(n.a.PARSING_INIT_SEGMENT,o),i.on(n.a.ERROR,o),i.on(n.a.SCRIPT_PARSED,o),i.on(n.a.LOAD_END,o),i.on(n.a.PARSING_DATA,(function(t,i){var r={event:t,data:i};r.payload=i.payload,delete i.payload,e.postMessage(r,[r.payload.buffer])})),e.addEventListener("message",(function(e){var r=e.data;switch(r.cmd){case"init":a.b.level(r.config.debug),function(e,i,r,n){(t=new s.a(e,i,r,n)).init()}(i,r.config,r.data,r.vendor);break;case"destroy":t&&t.destroy(),i&&i.removeAllListeners();break;case"append":t.append(r.tags,r.timeOffset,r.discontinuity,r.contiguous,r.accurateTimeOffset);break;case"flvHead":t.flvHead(r.hasAudio,r.hasVideo);break;case"flush":t.flush();break;case"setExtra":t.setExtra(r.data);break;case"end":t.end()}}))}},function(e,t,i){"use strict";i.r(t);var r=i(4),n=i(6),s=i(5),a=i(1),o=new RegExp("^(http|https)://"),u={webWorker:!0,autoCleanupMaxBackwardDuration:60,autoCleanupMinBackwardDuration:15,appendErrorMaxRetry:3,credentials:!1,defaultSpts:-2e3,debug:a.a.LEVEL_ERROR,connectionTimeout:1e4,transmissionTimeout:3e4,stretchShortVideoTrack:!1,maxBufferHole:.5,maxAudioFramesDrift:5},h=function(){function e(){}return e.processConfig=function(t){var i=Object(r.a)({},u);return Object(r.a)(i,t),e.setSrc(i),window.Worker||(i.webWorker=!1),i.debug&&a.b.level(i.debug),e.detectStreamingMux(i),i.autoCleanupMaxBackwardDuration=Math.max(i.autoCleanupMaxBackwardDuration,i.autoCleanupMinBackwardDuration+10),i},e.detectStreamingMux=function(e){e.gopRemux=s.a.safari||s.a.opera&&s.a.version.major<37},e.setSrc=function(e,t){if(void 0===t&&(t=null),t&&(e.src=t,e.manifest=""),"string"==typeof e.src&&!o.test(e.src))try{e.src=JSON.parse(e.src)}catch(t){e.manifest=""}"object"==typeof e.src&&(e.manifest=e.src,e.src="")},e}(),d=i(2),f=i(0);function _(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){this._video=void 0,this._mse=void 0,this._streamTime=0,this._localTime=0}var t,i,r,n=e.prototype;return n.reset=function(){this._streamTime=0,this._localTime=0},n.attachVideo=function(e){this._video=e},n.attachMSE=function(e){this._mse=e},n.isTimeinBuffered=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++)if(e>=t.start(i)&&e<t.end(i))return!0;return!1},n.bufferedSec=function(){return this._video&&this._video.buffered.length>0?Math.max(0,this._video.buffered.end(this._video.buffered.length-1)-this._video.currentTime):0},n.bufferedSecByType=function(e){if(this._mse&&this._video&&this._mse.bufferedEndByType(e)>0)return this._mse.bufferedEndByType(e)-this._video.currentTime;return 0},n.mseBufferedSecByType=function(e){return this._mse?this._mse.bufferedByType(e):{start:0,end:0}},n.bufferSliceNumByType=function(e){return this._mse?this._mse.bufferSliceNumByType(e):0},n.pendingNum=function(){return this._mse?this._mse.pendingNum():0},n.pendingSecByType=function(e){return this._mse?this._mse.pendingSecByType(e):0},n.currentBuffer=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r<=e&&e<n)return{start:r,end:n}}},n.nextBuffer=function(e){if(this._video)for(var t=this._video.buffered,i=0;i<t.length;i++){var r=t.start(i),n=t.end(i);if(r>e)return{start:r,end:n}}},n.updateStreamTime=function(e,t){this._streamTime=e,this._localTime=t},n.getLocalTime=function(e){if(this._streamTime)return e-this._streamTime+this._localTime},t=e,(i=[{key:"video",get:function(){return this._video}},{key:"mse",get:function(){return this._mse}},{key:"mseReadyState",get:function(){return this._mse?this._mse.readyState:"closed"}},{key:"videoReadyState",get:function(){return this._video?this._video.readyState:0}},{key:"currentTime",get:function(){return this._video?this._video.currentTime:0}}])&&_(t.prototype,i),r&&_(t,r),e}();function l(){return window.MediaSource||window.WebKitMediaSource}function p(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var v=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this).tag="mse-controller",i._config=void 0,i.video=void 0,i._sourceBuffer=void 0,i._mediaSource=null,i._mimeCodec=void 0,i._cleanUpTask=void 0,i._appendQueue=void 0,i._hasVideo=void 0,i._hasAudio=void 0,i._endOfData=!1,i._appendEnabled=void 0,i._duration=null,i._appendError=0,i._appendBufferError=!1,i._sbHandler={},i._souceBufferLocked=!1,i._onSourceOpen=function(){a.b.i(i.tag,"MediaSource onSourceOpen"),i._mediaSource&&(i._mediaSource.removeEventListener("sourceopen",i._onSourceOpen),i._checkSourceBuffer(),i.refresh(),i.emit("source_open"))},i._onSourceEnded=function(){a.b.i(i.tag,"MediaSource onSourceEnded")},i._onSourceClose=function(){a.b.i(i.tag,"MediaSource onSourceClose"),i._mediaSource&&(i._mediaSource.removeEventListener("sourceopen",i._onSourceOpen),i._mediaSource.removeEventListener("sourceended",i._onSourceEnded),i._mediaSource.removeEventListener("sourceclose",i._onSourceClose))},i._onSourceBufferUpdateEnd=function(e){i._update(e),i._endOfData&&i._endOfStream(),i.emit("updateend")},i._onSourceBufferError=function(e){a.b.e(i.tag,"SourceBuffer Error: "+e),i.emit(f.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.SOURCEBUFFER_ERROR,fatal:!0,reason:"source buffer error"})},i._config=t,i._hasVideo=!1,i._hasAudio=!1,i._appendQueue={video:[],audio:[],audiovideo:[]},i._sourceBuffer={},i._cleanUpTask={video:[],audio:[],audiovideo:[]},i._mimeCodec={},i._appendEnabled=!0,i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,o,u,h=r.prototype;return h.attach=function(e){var t=this;this.video=e;var i=l();if(i){var r=this._mediaSource=new i;this.video.src=URL.createObjectURL(r),this.video.load(),r.addEventListener("sourceopen",this._onSourceOpen),r.addEventListener("sourceended",this._onSourceEnded),r.addEventListener("sourceclose",this._onSourceClose),this._souceBufferLocked=!1}else setTimeout((function(){t.emit(f.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.MEDIASOURCE_ERROR,fatal:!0,reason:"MediaSource is not support"})}),0)},h.trackInfo=function(e){if((this._hasAudio!==e.hasAudio||this._hasVideo!==e.hasVideo||!!e.audiovideo!=!!this._mimeCodec.audiovideo)&&this.video&&this.hasSourceBuffer()){for(var t in a.b.i(this.tag,"trackInfo rebuild mse"),this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend));this._sourceBuffer={},this._mediaSource&&(this._mediaSource.removeEventListener("sourceopen",this._onSourceOpen),this._mediaSource.removeEventListener("sourceended",this._onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this._onSourceClose)),this._mimeCodec={},this.attach(this.video)}e.audiovideo?this._mimeCodec.audiovideo='video/mp4; codecs="'+e.codec+'"':(e.hasAudio&&e.audioCodec&&(this._mimeCodec.audio='audio/mp4; codecs="'+e.audioCodec+'"'),e.hasVideo&&e.videoCodec&&(this._mimeCodec.video='video/mp4; codecs="'+e.videoCodec+'"')),this._hasAudio=this._hasAudio||e.hasAudio,this._hasVideo=this._hasVideo||e.hasVideo,this._checkSourceBuffer()},h._checkSourceBuffer=function(){var e=(this._hasAudio?1:0)+(this._hasVideo?1:0),t=(this._mimeCodec.audio?1:0)+(this._mimeCodec.video?1:0);if(this._mimeCodec.audiovideo&&(e=1,t=1),a.b.v(this.tag,"checkSourceBuffer",e,t,this._mimeCodec),this._mediaSource&&"open"===this._mediaSource.readyState&&e>0&&t>=e)for(var i in this._mimeCodec)this._mimeCodec[i]&&this._addSourceBuffer(i)},h._addSourceBuffer=function(e){var t=this;if(!this._sourceBuffer[e]&&!this._souceBufferLocked){try{this._mediaSource&&(this._sourceBuffer[e]=this._mediaSource.addSourceBuffer(this._mimeCodec[e]))}catch(e){return a.b.e(this.tag,e),void this.emit(f.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.ADDSOURCEBUFFER_ERROR,fatal:!0,reason:e.message})}var i=this._sourceBuffer[e];this._sbHandler[e]={updateend:function(){t._onSourceBufferUpdateEnd(e)},error:function(e){t._onSourceBufferError(e)}},i.addEventListener("error",this._sbHandler[e].error),i.addEventListener("updateend",this._sbHandler[e].updateend),this._duration&&this._mediaSource&&(this._mediaSource.duration=this._duration)}},h._hasPendingData=function(){return!(!this._appendQueue||!(this._appendQueue.video&&this._appendQueue.video.length||this._appendQueue.audio&&this._appendQueue.audio.length))},h.refresh=function(){for(var e in this._sourceBuffer)this._update(e)},h._doAppend=function(e){if(this._hasPendingData()){if(!this._appendEnabled)return void(this._getBufferQueueSize()>209715200&&!this._appendBufferError&&(this._appendBufferError=!0,this.emit(f.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.APPENDBUFFER_ERROR,fatal:!0,reason:"bufferfull"})));if(this._appendQueue[e].length>0&&this._sourceBuffer[e]&&!this._sourceBuffer[e].updating&&!this._appendBufferError){var t=this._appendQueue[e].shift();this._appendBuffer(t,e)}}},h.mediaSegment=function(e){var t=e.type,i=this._appendQueue[t];this._souceBufferLocked&&!this._sourceBuffer[t]||i.push(e),this._sourceBuffer[t]&&(this._souceBufferLocked=!0,this._update(t))},h.bufferedByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?{start:t.buffered.start(0),end:t.buffered.end(t.buffered.length-1)}:{start:0,end:0}},h.bufferedEndByType=function(e){var t=this._sourceBuffer[e];return t&&t.buffered.length>0?t.buffered.end(t.buffered.length-1):0},h.bufferSliceNumByType=function(e){var t=this._sourceBuffer[e];return t?t.buffered.length:0},h.pendingSecByType=function(e){var t=this._appendQueue[e];return t?t.reduce((function(e,t){return e+t.duration}),0):0},h.pendingNum=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].length;return e},h._calculateRemoveRange=function(e){var t=this.video;if(t&&!t.seeking){var i=t.currentTime;if(this._sourceBuffer[e]){var r=this._cleanUpTask[e],n=this._sourceBuffer[e].buffered;if(n.length>=1&&i-n.start(0)>=this._config.autoCleanupMaxBackwardDuration){var s=i-this._config.autoCleanupMinBackwardDuration;if(r.length&&0===r[r.length-1].start&&r[r.length-1].end===s)return;r.push({start:0,end:s})}}}},h._cleanUpRange=function(e,t){var i=this._sourceBuffer[e];if(i){if(i.updating)return!1;try{for(var r=0;r<i.buffered.length;r++){var n=s.a.firefox?0:i.buffered.start(r),a=i.buffered.end(r),o=Math.max(n,t.start),u=Math.min(a,t.end);if(u>o&&(i.remove(o,u),this.emit("remove"),r<i.buffered.length-1))return!1}}catch(e){}}return!0},h._appendBuffer=function(e,t){if(this._sourceBuffer[t]&&this.video&&!this.video.error)try{this._sourceBuffer[t].appendBuffer(e.data.buffer)}catch(o){if(a.b.w(this.tag,o.code,o),22!==o.code)this._appendError?this._appendError++:this._appendError=1,this._appendError>this._config.appendErrorMaxRetry?(this._appendBufferError=!0,this.emit(f.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.APPENDBUFFER_ERROR,fatal:!0,reason:o.message})):this._appendQueue[t].unshift(e);else{var i=this.video,r=this._config;this._appendEnabled=!1,this._appendQueue[t].unshift(e);var n=i.buffered.end(i.buffered.length-1)-i.currentTime,s=i.currentTime-i.buffered.start(0);n<30?(s<r.autoCleanupMaxBackwardDuration&&(r.autoCleanupMaxBackwardDuration=Math.max(r.autoCleanupMaxBackwardDuration/2,20),r.autoCleanupMinBackwardDuration=10),this._calculateRemoveRange(t),this.hasCleanUpTask(t)&&this._cleanUp(t)):s<r.autoCleanupMinBackwardDuration&&this.emit(f.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.APPENDBUFFER_ERROR,fatal:!0,reason:"buffer full, append error"}),a.b.i(this.tag,"mse bufferfull"),this.emit("bufferFull")}}},h.flush=function(e,t,i){var r=0,n=Number.POSITIVE_INFINITY;for(var s in this._endOfData=!1,this._sourceBuffer){if(!i||i===s)if(this._sourceBuffer[s]){if(e){r=Math.max(r,e);for(var a=this._appendQueue[s].length-1;a>=0&&(!this._appendQueue[s][a].startPTS||this._appendQueue[s][a].startPTS>=e);a--)this._appendQueue[s].pop()}else this._appendQueue[s]=[];t&&(n=Math.min(n,t)),this._cleanUpTask[s].push({start:r,end:n}),this._cleanUp(s)}}this._appendEnabled=!0},h.setAppendEnabled=function(e){!this._appendEnabled&&e?(this._appendEnabled=e,this.refresh()):this._appendEnabled=e},h.getAppendEnabled=function(){return this._appendEnabled},h.endOfData=function(){this._endOfData=!0,this._hasPendingData()||this._endOfStream()},h.ended=function(){return this._endOfData},h._endOfStream=function(){var e=this._mediaSource;if(e&&"open"===e.readyState){for(var t in this._sourceBuffer){var i=this._sourceBuffer[t];if(i&&i.updating)return}try{e.endOfStream()}catch(e){a.b.e(this.tag,e),this.emit(f.a.ERROR,{type:d.b.MSE_ERROR,details:d.a.ENDOFSTREAM_ERROR,fatal:!0,reason:e.message})}}},h.destroy=function(){if(this._mediaSource){var e=this._mediaSource;if(this._endOfStream(),"closed"!==e.readyState)for(var t in this._sourceBuffer)this._sourceBuffer[t]&&this._sbHandler[t]&&(this._sourceBuffer[t].removeEventListener("error",this._sbHandler[t].error),this._sourceBuffer[t].removeEventListener("updateend",this._sbHandler[t].updateend),e.removeSourceBuffer(this._sourceBuffer[t]));e.removeEventListener("sourceopen",this._onSourceOpen),e.removeEventListener("sourceended",this._onSourceEnded),e.removeEventListener("sourceclose",this._onSourceClose),this._mediaSource=null}this.removeAllListeners(),this._appendQueue={},this._mimeCodec={},this._cleanUpTask={},this._sourceBuffer={},this._sbHandler={}},h.hasCleanUpTask=function(e){var t=0;if(void 0===e)for(var i in this._cleanUpTask)t+=this._cleanUpTask[i].length;else this._cleanUpTask[e]&&(t=this._cleanUpTask[e].length);return t>0},h.hasSourceBuffer=function(){return!!Object.keys(this._sourceBuffer).length},h._getBufferQueueSize=function(){var e=0;for(var t in this._appendQueue)e+=this._appendQueue[t].reduce((function(e,t){return t.data&&t.data.byteLength?e+t.data.byteLength:e}),0);return e},h.getBufferQueueSec=function(e){var t=this;return this._appendQueue?(e?[e]:Object.keys(this._appendQueue)).reduce((function(e,i){return t._appendQueue[i]&&t._appendQueue[i].length>0&&(0===Object.keys(t._sourceBuffer).length||t._sourceBuffer[i])?Math.max(e,t._appendQueue[i].reduce((function(e,t){return t.duration?e+t.duration:e}),0)):e}),0):0},h._update=function(e){this.hasCleanUpTask(e)&&this._cleanUp(e),this._doAppend(e)},h._cleanUp=function(e){for(var t=this._cleanUpTask[e];t&&t.length;){var i=t[0];if(!this._cleanUpRange(e,i))return;t.shift()}this.refresh()},n=r,(o=[{key:"readyState",get:function(){return this._mediaSource?this._mediaSource.readyState:"closed"}}])&&p(n.prototype,o),u&&p(n,u),r}(n.EventEmitter),m=i(9),g=i.n(m),y=i(10),b=i.n(y);function S(e,t){if(void 0===t)return e;var i=new b.a(e,!0);return i.query.lasSpts=""+t,i.toString()}var E=function(e){this.url=void 0,this.bitrate=0,this.maxBitrate=0,this.avgBitrate=0,this.qualityType="",this.qualityLabel="",this.id=0,this.codec="",this.hidden=!1,this.enableAdaptive=!0,this.defaultSelect=!1,this.url=e};function T(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var R=function(){function e(t){var i=this;this._levels=[],this._abrLevels=[],this._default=void 0,e.verify(t)&&(t.adaptationSet[0].representation.sort((function(e,t){return e.maxBitrate-t.maxBitrate})),t.adaptationSet[0].representation.forEach((function(e,t){var r=new E(e.url);r.id=e.id||0,r.maxBitrate=e.maxBitrate||0,r.avgBitrate=e.avgBitrate||0,r.bitrate=r.maxBitrate,r.qualityType=e.qualityType||"",r.qualityLabel=e.qualityLabel||"",r.codec=e.codecs||"",r.hidden=e.hidden||!1,r.enableAdaptive=void 0===e.disableAdaptive||!e.disableAdaptive,r.defaultSelect=e.defaultSelect||!1,i._levels.push(r),r.enableAdaptive&&i._abrLevels.push(t),r.defaultSelect&&void 0===i._default&&(i._default=t)})))}var t,i,r;return e.verify=function(e){return!!(e&&e.hasOwnProperty("version")&&e.hasOwnProperty("adaptationSet")&&Array.isArray(e.adaptationSet)&&e.adaptationSet.length>0)&&e.adaptationSet.reduce((function(e,t){return!!(e&&t.representation&&t.representation.length)}),!0)},t=e,(i=[{key:"levels",get:function(){return this._levels}},{key:"abrLevels",get:function(){return this._abrLevels}},{key:"default",get:function(){return this._default||0}}])&&T(t.prototype,i),r&&T(t,r),e}(),w=i(7),A=function(){function e(e,t){this.data=new Float32Array(0),this.length=0,this.shape=[0],this.type=Float32Array,"number"==typeof e&&"number"==typeof t?this._init(new Float32Array(e*t),{shape:[e,t]}):this._init(e,t)}e.add=function(e,t){return e.copy().add(t)},e.subtract=function(e,t){return e.copy().subtract(t)},e.augment=function(e,t){return e.copy().augment(t)},e.multiply=function(e,t){return e.multiply(t)},e.zeros=function(t,i,r){return void 0===r&&(r=Float32Array),e.fill(t,i,0,r)},e.fill=function(t,i,r,n){if(void 0===r&&(r=0),void 0===n&&(n=Float32Array),t<=0||i<=0)throw new Error("invalid size");return new e(new n(t*i),{shape:[t,i]}).fill(r)},e.identity=function(t,i){return void 0===i&&(i=Float32Array),e.fill(t,t,(function(e){return e%t===Math.floor(e/t)?1:0}),i)};var t=e.prototype;return t._init=function(t,i){if((r=t)&&r.buffer instanceof ArrayBuffer&&r.BYTES_PER_ELEMENT)this.data=t,this.shape="object"==typeof i?i.shape:[this.data.length],this.length=this.data.length,this.type=function(e){switch(e.constructor.name){case"Int8Array":return Int8Array;case"Uint8Array":return Uint8Array;case"Int16Array":return Int16Array;case"Uint16Array":return Uint16Array;case"Int32Array":return Int32Array;case"Uint32Array":return Uint32Array;case"Uint8ClampedArray":return Uint8ClampedArray;case"Float64Array":return Float64Array;default:return Float32Array}}(t);else if(t instanceof Array)this.data=new Float32Array(function e(t){return t.reduce((function(t,i){return t.concat(Array.isArray(i)?e(i):i)}),[])}(t)),this.shape=function e(t){return Array.isArray(t)?[t.length].concat(e(t[0])):[]}(t),this.length=this.data.length;else if(t instanceof e)return t.copy();var r},t.multiply=function(t){var i=this.shape,r=i[0],n=i[1],s=t.shape,a=s[0],o=s[1];if(n!==a)throw new Error("sizes do not match");var u,h,d,f,_=this.data,c=t.data,l=new this.type(r*o);for(u=0;u<r;u+=1)for(h=0;h<o;h+=1){for(f=0,d=0;d<n;d+=1)f+=_[u*n+d]*c[h+d*o];l[u*o+h]=f}return new e(l,{shape:[r,o]})},t.add=function(e,t){void 0===t&&(t=1),this.equilateral(e),this.equidimensional(e);var i,r=this.data,n=this.length,s=e.data;for(i=0;i<n;i+=1)r[i]+=t*s[i];return this},t.subtract=function(e){return this.add(e,-1)},t.augment=function(e){var t=this.shape,i=t[0],r=t[1],n=e.shape,s=n[0],a=n[1];if(0===s||0===a)return this;if(i!==s)throw new Error("rows do not match");var o,u,h=this.data,d=e.data,f=r+a,_=new this.type(f*i);for(o=0;o<i;o+=1)for(u=0;u<r;u+=1)_[o*f+u]=h[o*r+u];for(o=0;o<s;o+=1)for(u=0;u<a;u+=1)_[o*f+u+r]=d[o*a+u];return this.shape=[i,f],this.length=_.length,this.data=_,this},t.fill=function(e){void 0===e&&(e=0);var t,i=this.data,r=this.length;for(t=0;t<r;t+=1)i[t]=e instanceof Function?e(t):e;return this},t.transpose=function(){var t,i,r=this.shape,n=r[0],s=r[1],a=new this.type(s*n);for(t=0;t<n;t+=1)for(i=0;i<s;i+=1)a[i*n+t]=this.data[t*s+i];return new e(a,{shape:[s,n]})},t.inverse=function(){var t=this.shape,i=t[0],r=t[1];if(i!==r)throw new Error("invalid dimensions");var n,s,a=e.identity(i),o=e.augment(this,a).gauss(),u=e.zeros(i,r),h=e.zeros(i,r),d=o.shape[1];for(n=0;n<i;n+=1)for(s=0;s<d;s+=1)s<r?u.set(n,s,o.get(n,s)):h.set(n,s-i,o.get(n,s));if(!u.equals(e.identity(i)))throw new Error("matrix is not invertible");return h},t.gauss=function(){var e,t,i,r,n,s=this.shape,a=s[0],o=s[1],u=this.copy(),h=0;for(i=0;i<a;i+=1){if(o<=h)throw new Error("matrix is singular");for(r=i;0===u.data[r*o+h];)if(a===(r+=1)&&(r=i,o===(h+=1)))throw new Error("matrix is singular");if(u.swap(i,r),0!==(e=u.data[i*o+h]))for(n=0;n<o;n+=1)u.data[i*o+n]=u.data[i*o+n]/e;for(r=0;r<a;r+=1)if(t=u.data[r*o+h],r!==i)for(n=0;n<o;n+=1)u.data[r*o+n]=u.data[r*o+n]-u.data[i*o+n]*t;h+=1}for(i=0;i<a;i+=1){for(e=0,r=0;r<o;r+=1)0===e&&(e=u.data[i*o+r]);if(0===e)for(n=0;n<o;n+=1)u.data[i*o+n]=u.data[i*o+n]/e}return u},t.equals=function(e){this.equilateral(e),this.equidimensional(e);var t,i=this.data,r=this.length,n=e.data;for(t=0;t<r;t+=1)if(i[t]!==n[t])return!1;return!0},t.check=function(e,t){var i=this.shape,r=i[0],n=i[1];if(isNaN(e)||isNaN(t))throw new Error("one of the indices is not a number");if(e<0||t<0||e>r-1||t>n-1)throw new Error("index out of bounds")},t.set=function(e,t,i){return this.check(e,t),this.data[e*this.shape[1]+t]=i,this},t.get=function(e,t){return this.check(e,t),this.data[e*this.shape[1]+t]},t.swap=function(e,t){var i=this.shape,r=i[0],n=i[1];if(e<0||t<0||e>r-1||t>r-1)throw new Error("index out of bounds");if(this.data.slice){var s=this.data.slice(e*n,(e+1)*n);this.data.copyWithin(e*n,t*n,(t+1)*n),this.data.set(s,t*n)}else{var a=new(0,this.data.constructor)(this.data.buffer.slice(0));this.data.set(a.subarray(e*n,(e+1)*n),t*n),this.data.set(a.subarray(t*n,(t+1)*n),e*n)}return this},t.copy=function(){var e=Object(r.a)(Object.create(Object.getPrototypeOf(this)),this);return e.data=new this.type(this.data),e.shape=this.shape,e.length=this.length,e.type=this.type,e},t.equidimensional=function(e){var t=this.shape,i=e.shape;if(!t.every((function(e,t){return e===i[t]})))throw new Error("shapes "+t+" and "+i+" do not match")},t.equilateral=function(e){var t=this.length,i=e.length;if(t!==i)throw new Error("lengths "+t+" and "+i+" do not match")},e}();function L(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var x={beacon:!1,predictStep:5,minBuffer:.2,bufferOffset:-1,duration:2,smoothRatioToTarget:.25,speedSmoothRatio:.5,switchPenalty:15e-7,slidingWindowSize:3,kalmanR:Math.pow(.2,2),kalmanQ:4e-4,initBitrateLevel:3,speedPredictNum:3},O=function(e){var t,i;function n(){var t;return(t=e.call(this)||this).MATRIX_E=void 0,t.MATRIX_G=void 0,t._conf=void 0,t._xPrev=0,t._PPrev=0,t._pastBuffer=void 0,t._pastThroughput=void 0,t._levels=void 0,t._availableList=void 0,t._current=0,t._next=0,t}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s,o,u,h=n.prototype;return h.init=function(e,t){this._processConfig(t),a.b.i("algorithm-flv","init",e,t,this._conf),this._levels=e.levels.slice(0),this._current=e.default,this._next=0,this._pastBuffer=[0,0],this._pastThroughput=new Array(this._conf.slidingWindowSize),this._pastThroughput[this._conf.slidingWindowSize-1]=0,this._xPrev=0,this._PPrev=0,this.MATRIX_E=A.zeros(this._conf.predictStep,this._conf.predictStep),this.MATRIX_G=A.zeros(this._conf.predictStep,2);for(var i=0;i<this._conf.predictStep;i++)for(var r=0;r<i+1;r++)this.MATRIX_E.set(i,r,i-r+1);for(var n=0;n<this._conf.predictStep;n++)this.MATRIX_G.set(n,0,n+2),this.MATRIX_G.set(n,1,-n-1)},h.setAvailableBitrates=function(e){e.length&&(this._availableList=e)},h.onGOP=function(e,t,i){var r=t/i*8/1024;this._next=this._nextRateIndex(this._recentSpeed(r),e)},h.onLevelLoad=function(e){this._current=Math.max(0,e)},h._processConfig=function(e){var t=Object(r.a)({},x);this._conf=Object(r.a)(t,e)},h._quantization=function(e,t){for(var i=this._current,r=this._levels.length-1;r>=0;r--)if(e>=this._levels[r].bitrate){i=r;break}return i>this._current&&t<this._levels[i].bitrate&&(i-=1),i},h._nextRateIndex=function(e,t){this._pastThroughput.shift(),this._pastThroughput.push(e);var i=this._nextRateBySpeedAndBuffered(e,t);if(i>=this._current?(this._pastBuffer.shift(),this._pastBuffer.push(t)):this._pastBuffer=[t,t],this._availableList&&this._availableList.length&&-1===this._availableList.indexOf(i)){for(var r=this._availableList.length-1;r>=0;r--)if(this._availableList[r]<=i){i=this._availableList[r];break}i=Math.max(i,this._availableList[0])}return i},h._resetAlgorithm=function(){this._pastBuffer=[0,0],this._pastThroughput=new Array(this._conf.slidingWindowSize)},h._recentBuffer=function(){return this._pastBuffer.reduce((function(e,t){return e+t}))/this._pastBuffer.length},h._recentSpeed=function(e){var t=this._pastThroughput[this._pastThroughput.length-1];return t>0?t*this._conf.speedSmoothRatio+e*(1-this._conf.speedSmoothRatio):e},h._adjustedTargetBuffer=function(){var e=Math.max(this._conf.minBuffer,this._recentBuffer()+this._conf.bufferOffset);return a.b.v("algorithm-flv","targetBuffer:"+e),e},h._rateChangeArray=function(e,t,i,r){var n=new A(r);this._printFirstColumn(n,"targetBufferArray");var s=this.MATRIX_G,a=A.multiply(s,i);this._printFirstColumn(a,"predictedBufferArray");var o=this.MATRIX_E.multiply(this._diag(t));return A.multiply(A.multiply(A.add(A.multiply(o.transpose(),o),e).inverse(),o.transpose()),A.subtract(n,a))},h._nextRateBySpeedAndBuffered=function(e,t){for(var i=this,r=A.zeros(this._conf.predictStep,this._conf.predictStep),n=0;n<this._conf.predictStep;n++)r.set(n,n,this._conf.switchPenalty*(this._conf.predictStep-n));var s=this._multistepPred(this._pastThroughput,this._conf.predictStep);a.b.v("algorithm-flv","futureThroughput:"+s);var o=s.map((function(e){return-i._conf.duration/e})),u=new A([[t],[this._recentBuffer()]]),h=[];h[0]=[t];for(var d=this._adjustedTargetBuffer(),f=0;f<this._conf.predictStep;f++)h[f+1]=[this._conf.smoothRatioToTarget*h[f]+(1-this._conf.smoothRatioToTarget)*d];var _=this._rateChangeArray(r,o,u,h.slice(1));return a.b.v("algorithm-flv","algorithm input speed:"+e+" buffered:"+t,"output result:"+_.get(0,0)),this._quantization(this._levels[this._current].bitrate+_.get(0,0),e)},h._printFirstColumn=function(e,t){for(var i=[],r=0;r<e.shape[0];++r)i[r]=+e.get(r,0).toFixed(2);a.b.v("algorithm-flv",t,JSON.stringify(i))},h._printFirstRow=function(e,t){for(var i=[],r=0;r<e.shape[0];++r)i[r]=+e.get(0,r).toFixed(2);a.b.v("algorithm-flv",t,JSON.stringify(i))},h._diag=function(e){for(var t=[],i=e.length,r=0;r<i;r++){t[r]=new Array(i);for(var n=0;n<i;n++)t[r][n]=0;t[r][r]=e[r]}return new A(t,{shape:[i,i]})},h._multistepPred=function(e,t){for(var i=new Array(t),r=e.slice(0),n=0;n<t;n++){for(var s=0,a=0,o=0;o<e.length;o++)r[o]&&(s+=1/r[o],a+=1);0!==a&&(i[n]=1/(s/a),r.shift(),r.push(i[n]))}return i},h._multistepKalmanfilter=function(e,t,i,r){for(var n=this._conf.kalmanR,s=this._conf.kalmanQ,a=new Array(this._conf.predictStep),o=e,u=i,h=0,d=0,f=0;f<r;f++){var _=u+s,c=_/(_+n),l=o+c*(t-o),p=(1-c)*_;0===f&&(h=l,d=p),a[f]=l,o=l,u=p}return{futureThroughput:a,xRet:h,PRet:d}},s=n,(o=[{key:"nextLevel",get:function(){return this._next}}])&&L(s.prototype,o),u&&L(s,u),n}(n.EventEmitter);function k(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var D=function(e){var t,i;function r(t,i){var r;return(r=e.call(this)||this)._config=void 0,r._media=void 0,r._next=0,r._downloadSize=0,r._downloadStartTime=0,r._keyCount=0,r._index=0,r._alg=void 0,r._manifest=void 0,r._autoLevelEnabled=!1,r._config=t,r._media=i,r._manifest=new R(t.manifest),r._alg=new O,r._alg.init(r._manifest),r._autoLevelEnabled=r._manifest.abrLevels.length>0,r}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,s,a,o=r.prototype;return o.init=function(){this._downloadSize=0,this._downloadStartTime=performance.now(),this._keyCount=0,this._index=this._next=0,this.current&&(this._autoLevelEnabled&&(this._index=this._next=this._alg.nextLevel),this.trigger(f.a.MANIFEST_PARSED,{levels:this._manifest.levels,currentLevel:this._index}))},o.destory=function(){this._alg&&this._alg.removeAllListeners()},o.onLoaderChunk=function(e){this._downloadSize+=e},o.onLevelLoad=function(e){this._manifest.levels.length&&e>=0&&e<this._manifest.levels.length&&(this._keyCount=0,this._index=e,this._downloadStartTime=performance.now(),this._downloadSize=0,this._alg.onLevelLoad(e))},o.onKeyFrame=function(e){var t=this._manifest.levels;if(this._keyCount++,(this._alg||this._next!==this._index)&&this._keyCount>1&&t){var i=this._index;if(this._next!==this._index)i=this._next;else{if(!this._autoLevelEnabled)return;var r=performance.now();this._alg.onGOP(this._media.bufferedSec(),this._downloadSize,(r-this._downloadStartTime)/1e3),this._downloadSize=0,this._downloadStartTime=r,this._next=i=this._alg.nextLevel}if(i!==this._index)return{url:this._getRequestUrl(i,e),level:i}}},o._getRequestUrl=function(e,t){var i=this._config.src,r=this._manifest.levels[e];return r&&(i=r.url),S(i,t||this._config.defaultSpts)},n=r,(s=[{key:"autoLevelEnabled",get:function(){return this._autoLevelEnabled}},{key:"levels",get:function(){return this._manifest.levels}},{key:"nextLevel",get:function(){return"number"==typeof this._next?this._next:this._index},set:function(e){e>=0&&this._manifest.levels.length>e?(this._autoLevelEnabled=!1,this._next=e):-1===e&&(this._autoLevelEnabled=!0)}},{key:"currentLevel",get:function(){return this._index},set:function(e){e>=0&&this._manifest.levels.length>e?(this._autoLevelEnabled=!1,this._index=this._next=e):-1===e&&(this._autoLevelEnabled=!0)}},{key:"current",get:function(){return this._manifest.levels[this._index]}}])&&k(n.prototype,s),a&&k(n,a),r}(w.a),C=i(8);function M(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var I=function(){function e(t){void 0===t&&(t=0),this._size=void 0,this._readOffset=0,this._writeOffset=0,this._storage=void 0,this._cache=void 0,this._size=t>0?t:e.DEFAULT_CACHE_SIZE,this._storage=new ArrayBuffer(this._size),this._cache=new Uint8Array(this._storage)}var t,i,r,n=e.prototype;return n.put=function(e){if(this._readOffset===this._writeOffset&&(this._readOffset=this._writeOffset=0),this._writeOffset+e.byteLength>this._size){var t=this._writeOffset+e.byteLength-this._readOffset;t>this._size?(this._collateCache(),this.expandCache(t)):this._collateCache()}this._cache.set(e,this._writeOffset),this._writeOffset+=e.byteLength},n.get=function(e){if(e+this._readOffset>this._writeOffset)return null;var t=null;if(this._cache.slice)t=this._cache.slice(this._readOffset,this._readOffset+e);else{var i=this._cache.byteOffset+this._readOffset;t=new Uint8Array(this._storage.slice(i,i+e))}return this._readOffset+=e,t},n.read=function(e){return e+this._readOffset>this._writeOffset?null:new Uint8Array(this._storage,this._readOffset,e)},n.skip=function(e){e+this._readOffset>this._writeOffset||(this._readOffset+=e)},n.clear=function(){this._readOffset=this._writeOffset=0},n.expandCache=function(t){if(void 0===t&&(t=0),this._size=Math.max(2*this._size,t),this._size>=e.MAX_CACHE_SIZE)throw new Error("max cache size");0===this._readOffset&&0===this._writeOffset?this._storage=new ArrayBuffer(this._size):this._storage=this._transfer(this._storage,this._size),this._cache=new Uint8Array(this._storage)},n._collateCache=function(){var e=new Uint8Array(this._storage,this._readOffset,this._writeOffset-this._readOffset);this._cache.set(e),this._writeOffset-=this._readOffset,this._readOffset=0},n._transfer=function(e,t){if(!(e instanceof ArrayBuffer))throw new TypeError("Source must be an instance of ArrayBuffer");if(t<=e.byteLength)return e.slice(0,t);var i=new Uint8Array(e),r=new Uint8Array(new ArrayBuffer(t));return r.set(i),r.buffer},t=e,(i=[{key:"unreadLen",get:function(){return this._writeOffset-this._readOffset}}])&&M(t.prototype,i),r&&M(t,r),e}();I.MAX_CACHE_SIZE=104857600,I.DEFAULT_CACHE_SIZE=3145728;var B,P=I,U=i(3),F=function(){function e(e,t){this._observer=void 0,this._cache=void 0,this._tag=void 0,this._result=void 0,this._parseLen=0,this._parseFunc=void 0,this._onAbr=void 0,this._observer=e,this._onAbr=t,this._cache=new P,this._parseLen=U.a.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._result={list:[]}}var t=e.prototype;return t.reset=function(){this._parseLen=U.a.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0,this._result.list=[],this._result.abr=void 0},t.append=function(e){for(this._cache.put(new Uint8Array(e));this._cache.unreadLen>this._parseLen;)this._parseFunc();var t={list:this._result.list.splice(0),abr:this._result.abr};return this._result.abr=void 0,t},t._parseFlvHead=function(){var e=this._cache.read(U.a.FLV_HEAD_LEN);e&&(70===e[0]&&76===e[1]&&86===e[2]&&1===e[3]||this._observer.trigger(f.a.ERROR,{type:d.b.MUX_ERROR,details:d.a.PARSING_ERROR,fatal:!0,reason:"Flv: wrong head"}),this._observer.trigger(f.a.FLV_HEAD,{hasAudio:(4&e[4])>>>2,hasVideo:1&e[4]}),this._cache.skip(U.a.FLV_HEAD_LEN),this._parseLen=U.a.FLV_TAG_HEAD_LEN,this._parseFunc=this._parseFlvTagHead)},t._parseFlvTagHead=function(){this._tag=new U.b;var e=this._cache.read(U.a.FLV_TAG_HEAD_LEN);e&&(this._tag.tagType=e[0],this._tag.dataSize=((255&e[1])<<16)+((255&e[2])<<8)+(255&e[3]),this._tag.timestamp=((255&e[7])<<24)+((255&e[4])<<16)+((255&e[5])<<8)+(255&e[6]),this._cache.skip(U.a.FLV_TAG_HEAD_LEN),this._tag.tagType===U.c.VIDEO?(this._parseFunc=this._detectKeyFrame,this._parseLen=U.a.AVC_KEY_FRAME_CHECK_LEN):(this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+U.a.FLV_TAG_SIZE_LEN))},t._detectKeyFrame=function(){var e=this._cache.read(2);if(e&&this._tag){var t=(240&e[0])>>>4,i=e[1];this._parseFunc=this._parseFlvTag,this._parseLen=this._tag.dataSize+U.a.FLV_TAG_SIZE_LEN,1===t&&1===i&&this._onAbr&&(this._result.abr=this._onAbr(this._tag.timestamp),this._result.abr&&(this._parseLen=U.a.FLV_HEAD_LEN,this._parseFunc=this._parseFlvHead,this._cache.clear(),this._tag=void 0))}},t._parseFlvTag=function(){var e=this._tag;e&&(e.tagType!==U.c.SCRIPT&&e.tagType!==U.c.AUDIO&&e.tagType!==U.c.VIDEO||(e.body=this._cache.get(e.dataSize),this._cache.skip(4),e&&this._result.list.push(e),this._tag=void 0),this._parseFunc=this._parseFlvTagHead,this._parseLen=U.a.FLV_TAG_HEAD_LEN)},e}(),N=function(){function e(){this.tag="fetch",this._context=void 0,this._callbacks=null,this._controller=null,this._reader=null,this._abort=!1}e.isSupport=function(){return!(!self.fetch||!self.ReadableStream)};var t=e.prototype;return t.load=function(e,t){var i=this;this._context=e,this._callbacks=t;var r=new Headers;e.headers&&e.headers.forEach((function(e){r.append(e.header,e.value)})),e.range&&r.append("Range",e.range);var n={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade",signal:this._getAbortSignal()};e.credentials&&(n.credentials="include"),fetch(e.url,n).then((function(t){if(e.responseUrl=t.url,e.responseHeader=t.headers,i._callbacks&&i._callbacks.onConnect&&i._callbacks.onConnect(t.status),t.ok)return i._abort?void(t.body&&t.body.getReader().cancel()):"arraybuffer"===e.responseType?e.progress?void(t.body&&(i._reader=t.body.getReader(),i._pump(i._reader))):void t.arrayBuffer().then((function(t){i._onEnd(e,t)})):void t.text().then((function(t){i._onEnd(e,t)}));var r=new Error(t.status+" "+t.statusText);i._onError(r)})).catch((function(e){"AbortError"!==e.name&&i._onError(e)}))},t.abort=function(){this._controller?this._controller.abort():this._reader&&(this._reader.cancel(),this._reader=null),this._abort=!0},t.destroy=function(){this._callbacks=null,this.abort()},t._onProgress=function(e,t){this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t)},t._onEnd=function(e,t){this._callbacks&&this._callbacks.onEnd&&(this._reader=null,this._controller=null,this._callbacks.onEnd(e,t))},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},t._pump=function(e){var t=this;e.read().then((function(i){if(t._abort)return e.cancel(),null;if(i.done)return t._onEnd(t._context,null),null;var r=i.value.buffer;return t._onProgress(t._context,r),t._pump(e)})).catch((function(e){"AbortError"!==e.name&&t._onError(e)}))},t._getAbortSignal=function(){try{if(AbortController)return this._controller=new AbortController,this._controller.signal}catch(e){return null}return null},e}();!function(e){e.MOZ_CHUNK="moz-chunked-arraybuffer",e.MS_STREAM="ms-stream",e.UNKNOW="unknow",e.UNSUPPORT=""}(B||(B={}));var V,G=function(){function e(){this.tag="xhr",this._xhr=null,this._context=void 0,this._callbacks=null,this._reader=null,this._msBufferOffset=0,this._msBufferUpper=16777216,this._progress=B.UNKNOW,this._xhr=null,this._msBufferOffset=0}e.isSupportChunk=function(){if(e.supportChunk!==B.UNKNOW)return e.supportChunk;try{var t=new XMLHttpRequest;if(t.open("GET","https://example.com",!0),t.responseType=B.MOZ_CHUNK,t.responseType===B.MOZ_CHUNK)return e.supportChunk=B.MOZ_CHUNK,e.supportChunk}catch(t){e.supportChunk=B.UNSUPPORT}try{var i=new XMLHttpRequest;if(i.open("GET","https://example.com",!0),i.responseType=B.MS_STREAM,i.responseType===B.MS_STREAM)return e.supportChunk=B.MS_STREAM,e.supportChunk}catch(t){e.supportChunk=B.UNSUPPORT}return B.UNSUPPORT};var t=e.prototype;return t.load=function(t,i){if(this._callbacks=i,this._context=t,this._progress=B.UNSUPPORT,t.progress&&"arraybuffer"===t.responseType&&(this._progress=e.isSupportChunk(),this._progress===B.MS_STREAM)){var r=this._reader=new self.MSStreamReader;r.onprogress=this._msrOnProgress.bind(this),r.onload=this._onLoadEnd.bind(this),r.onerror=this._onError.bind(this)}var n=this._xhr=new XMLHttpRequest;n.open("GET",this._context.url,!0),this._progress===B.MOZ_CHUNK?(n.responseType=B.MOZ_CHUNK,n.onprogress=this._onProgress.bind(this),n.onload=this._onLoadEnd.bind(this)):this._progress===B.MS_STREAM?n.responseType=B.MS_STREAM:(n.responseType=t.responseType||"arraybuffer",n.onload=this._onLoadEnd.bind(this)),n.onreadystatechange=this._onReadyStateChange.bind(this),n.onerror=this._onError.bind(this),n.withCredentials=!!t.credentials,t.range&&n.setRequestHeader("Range",t.range),n.send()},t.abort=function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.destroy=function(){this._callbacks=null,this.abort()},t._onReadyStateChange=function(e){if(this._xhr){var t=this._xhr;2===t.readyState?(this._context.responseUrl=t.responseURL,this._context.responseHeader=t.getAllResponseHeaders(),this._callbacks&&this._callbacks.onConnect&&this._callbacks.onConnect(t.status),(t.status<200||t.status>299)&&this._onError(new Error("xhr error"))):3===t.readyState&&this._reader&&0===this._reader.readyState&&t.status>=200&&t.status<=299&&this._reader.readAsArrayBuffer(t.response)}},t._onProgress=function(e){if(this._xhr){var t=this._xhr.response;this._callbacks&&this._callbacks.onProgress&&t&&this._callbacks.onProgress(this._context,t)}},t._msrOnProgress=function(e){var t=e.target.result;if(t){var i=t.slice(this._msBufferOffset);this._msBufferOffset=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(this._context,i),t.byteLength>=this._msBufferUpper&&this._onError(new Error("ms buffer too large"))}else this._onError(new Error("ms buffer null"))},t._onLoadEnd=function(e){var t=null,i=this._xhr;!this._progress&&i&&(t=i.response),this._callbacks&&this._callbacks.onEnd(this._context,t)},t._onError=function(e){this._callbacks&&this._callbacks.onError&&this._callbacks.onError(e)},e}();G.supportChunk=B.UNKNOW;var H=0,j=function(){var e=t.prototype;function t(){this.tag="loader",this.context=void 0,this._loader=void 0,this._callbacks=null,this._config=void 0,this._loaderCallback=void 0,this._stats=void 0,this._retryDelay=0,this._loading=!1,this._aborted=!1,this._requestTimeout=void 0,this._transTimer=void 0,this._retryTimeout=void 0,this._rangeStart=void 0,this._continuedTransmissionRetry=!1,this._progressTime=0,this.tag="loader",H++,this._loader=null,this._config={useFetch:!1,connectionTimeout:0,transmissionTimeout:0,maxRetry:0,retryDelay:0},this._loaderCallback={onConnect:this._onConnect.bind(this),onProgress:this._onProgress.bind(this),onEnd:this._onEnd.bind(this),onError:this._onError.bind(this)}}return e._getInternalLoader=function(e){if(void 0!==V)return V;if(V=null,s.a.msie||s.a.msedge){if(e)return N.isSupport()&&(V=N),V;G.isSupportChunk()?V=G:N.isSupport()&&(V=N)}else N.isSupport()?V=N:G.isSupportChunk()&&(V=G);return V},e.load=function(e,t,i){this._init(e,t,i),this._loadInternal()},e.destroy=function(){this._stopTimer(),this._abortInternal(),this._destroyLoader(),this._callbacks=null},e._init=function(e,t,i){this.context=e,this._rangeStart=e.rangeStart,this._callbacks=t,this._config=i||this._config,this._stats={id:"",trequest:performance.now(),retry:0,loaded:0,code:0,output:0,tfirst:0,tload:0,total:0,tsload:0,tstart:0,fatal:!1,text:""},this._config.retryDelay&&(this._retryDelay=this._config.retryDelay)},e._destroyLoader=function(){this._loader&&(this._loader.destroy(),this._loader=null)},e._loadInternal=function(){this._loading=!0,this._aborted=!1;var e=this._stats;e.code=0,e.tfirst=0,e.loaded=0,this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this.context.progress?this._loader=new(this._getInternalLoader(!!this._config.useFetch)):this._loader=new G,this._loader&&(e.id=this._loader.tag+"-"+H,this._config.connectionTimeout&&(this._requestTimeout=setTimeout(this._onTimeout.bind(this),this._config.connectionTimeout)),this.context.rangeEnd?this.context.range="bytes="+this.context.rangeStart+"-"+(this.context.rangeEnd-1):this.context.rangeStart&&(this.context.range="bytes="+this.context.rangeStart+"-"),e.tsload=Date.now(),e.tstart=performance.now(),this._loader.load(this.context,this._loaderCallback))},e._abortInternal=function(){this._callbacks&&this._callbacks.onAbort&&!this._aborted&&this._loading&&this._callbacks.onAbort(this.context,this._stats),this._aborted=!0,this._loader&&this._loader.abort()},e.abort=function(){this._stopTimer(),this._abortInternal()},e._stopTimer=function(){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),this._stopTransmissionTimer()},e._onConnect=function(e){this._requestTimeout&&(clearTimeout(this._requestTimeout),this._requestTimeout=null),this._startTransmissionTimer(),this._stats.code=e,this._stats.tfirst=Math.max(this._stats.trequest,performance.now())},e._onProgress=function(e,t){var i=this._stats;if(this._progressTime=performance.now(),!this._continuedTransmissionRetry&&i.output>i.loaded){if(i.loaded+t.byteLength-i.output>0){var r=t.slice(i.output-i.loaded);this._callProgress(this.context,r,i)}}else this._callProgress(this.context,t,i);i.loaded+=t.byteLength},e._callProgress=function(e,t,i){this._stats.output+=t.byteLength,this._callbacks&&this._callbacks.onProgress&&this._callbacks.onProgress(e,t,i)},e._onEnd=function(e,t){this._stopTimer();var i=this._stats;i.total=t?i.loaded="string"==typeof t?t.length||0:t.byteLength||0:i.loaded,i.tload=Math.max(i.tfirst,performance.now()),this._loading=!1,i.output=0,this._callbacks&&this._callbacks.onEnd(e,t,i)},e._onError=function(e){a.b.i(this.tag,e),this._stopTimer(),this._destroyLoader();var t=this._stats,i=this._config;this._loading=!1,t.fatal=!i.maxRetry||t.retry>=i.maxRetry||!i.maxRetry,t.text=e.message||"load error",this._callbacks&&this._callbacks.onError&&this._callbacks.onError(this.context,t),t.fatal||(this._stats.output&&this._stats.loaded>0?(this._rangeStart?this.context.rangeStart=this._rangeStart+this._stats.output:this.context.rangeStart=this._stats.output,this._continuedTransmissionRetry=!0):(this.context.rangeStart=this._rangeStart,this._continuedTransmissionRetry=!1),t.retry++,this._callbacks&&(this._retryDelay?(this._retryTimeout=setTimeout(this._loadInternal.bind(this),this._retryDelay),this._retryDelay=2*this._retryDelay):this._loadInternal()))},e._onTimeout=function(){this._loading=!1,this._abortInternal();var e=new Error("timeout");this._onError(e)},e._startTransmissionTimer=function(){var e=this;this._stopTransmissionTimer(),this._progressTime=performance.now();var t=this._config.transmissionTimeout||0;t&&(this._transTimer=setInterval((function(){performance.now()-e._progressTime>t&&e._onTimeout()}),1e3))},e._stopTransmissionTimer=function(){this._transTimer&&(clearInterval(this._transTimer),this._transTimer=null)},t}(),z="startLoadStream",q="loader-chunk-arrival",W="keyFrame";function Q(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var K=function(e){var t,i;function n(t,i){var n;(n=e.call(this)||this)._config=void 0,n._media=void 0,n._w=void 0,n._flv=void 0,n._observer=void 0,n._loader=null,n._loaderConf=void 0,n._loaderCallbacks=void 0,n._multirate=void 0,n._contiguous=void 0,n._remuxId=void 0,n._discontinuity=!1,n._accurateTimeOffset=!1,n._baseTimeSec=0,n._tagDump=void 0,n._currentUrl=void 0,n._lastDTS=0,n._isAbr=!1,n._progressTime=0,n._onKeyframe=function(e){if(n._multirate){var t=n._multirate.onKeyFrame(e);if(t){n._tagDump&&n._tagDump.reset();var i=Object(r.a)({},t);return n._baseTimeSec=n._lastDTS,n.emit(f.a.LEVEL_SWITCHING,{level:i.level,startSec:n._baseTimeSec,smooth:!0}),n._media.updateStreamTime(0,0),i}}},n._onMessage=function(e,t){switch(e){case f.a.FLV_HEAD:n._w?n._w.postMessage({cmd:"flvHead",hasAudio:t.hasAudio,hasVideo:t.hasVideo}):n._flv&&n._flv.flvHead(t.hasAudio,t.hasVideo);break;case f.a.PARSING_INIT_SEGMENT:n.emit(f.a.PARSING_INIT_SEGMENT,t);break;case f.a.PARSING_DATA:if(t.extra&&t.extra.remuxId!==n._remuxId)break;"audio"===t.type&&t.startDTS>n._baseTimeSec&&n._media.updateStreamTime(t.streamDTS,t.startDTS),n._lastDTS=t.startDTS,n.emit(f.a.PARSING_DATA,{data:t.payload,type:t.type,startDTS:t.startDTS||0,endDTS:t.endDTS||0,startPTS:t.startPTS||0,endPTS:t.endPTS||0,duration:t.endDTS-t.startDTS,framesInfo:t.framesInfo});break;case f.a.DISCONTINUITY:n._w?n._w.postMessage({cmd:"flush"}):n._flv&&n._flv.flush(),n._tagDump.reset(),n._discontinuity=!0,n._accurateTimeOffset=!1,n._contiguous=!1,n._baseTimeSec=t;break;default:n.emit(e,t)}},n._config=t,n._media=i,t.manifest&&(R.verify(t.manifest)?n._isAbr=!0:(t.hasVideo=t.manifest.hasVideo,t.hasAudio=t.manifest.hasAudio)),n._loaderConf={connectionTimeout:n._config.connectionTimeout,transmissionTimeout:n._config.transmissionTimeout,maxRetry:0,retryDelay:0,useFetch:!0},n._loaderCallbacks={onProgress:n._onProgress.bind(X(n)),onError:n._onLoaderError.bind(X(n)),onEnd:n._onLoaderEnd.bind(X(n)),onAbort:n._onAbort.bind(X(n))},n._contiguous=!1,n._remuxId=1;var s=n._observer=new w.a,o=n._onMessage;return s.on(f.a.PARSING_INIT_SEGMENT,o),s.on(f.a.PARSING_DATA,o),s.on(f.a.ERROR,o),s.on(f.a.SCRIPT_PARSED,o),s.on(f.a.DISCONTINUITY,o),s.on(f.a.FLV_HEAD,o),n._tagDump=new F(s,n._onKeyframe),n._config.webWorker&&(a.b.i("TransFLV","webWorker"),n._onWorkMessage=n._onWorkMessage.bind(X(n)),n._w=g()(14),n._w)?(n._w.addEventListener("message",n._onWorkMessage),n._w.postMessage({cmd:"init",config:n._config,data:{remuxId:n._remuxId},vendor:navigator.vendor}),X(n)):(n._flv=new C.a(s,n._config,{remuxId:n._remuxId},navigator.vendor),n._flv.init(),n)}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var s,o,u,h=n.prototype;return h.init=function(){this._isAbr&&!this._multirate&&(this._multirate=new D(this._config,this._media),this._multirate.on(f.a.MANIFEST_PARSED,this._onMessage),this._multirate.init())},h._onWorkMessage=function(e){var t=e.data;e.data.event===f.a.PARSING_DATA&&(t.data.payload=t.payload),this._onMessage(e.data.event,t.data)},h.loadSource=function(){var e=this._multirate;if(e){var t=e.levels[e.currentLevel];t?this._load(S(t.url,this._config.defaultSpts),e.currentLevel):this.emit(f.a.ERROR,{type:d.b.OTHER_ERROR,details:d.a.PARSING_ERROR,fatal:!0,reason:"manifest parse error"})}else this._load(this._config.src)},h.destroy=function(){this._loader&&(this._loader.destroy(),this._loader=null),this._w&&(this._w.postMessage({cmd:"destroy"}),this._w.removeEventListener("message",this._onWorkMessage),this._w.terminate()),this._flv&&(this._flv.destroy(),this._flv=void 0),this._multirate&&(this._multirate.removeAllListeners(),this._multirate.destory());var e=this._observer;e&&e.removeAllListeners()},h._load=function(e,t){void 0===t&&(t=0),this._loader&&(this._loader.destroy(),this._loader=null),this._multirate&&this._multirate.onLevelLoad(t),this._currentUrl=e;var i=this.levels[t];this.emit(f.a.REPORT,{type:z,url:e,sync:this._baseTimeSec,index:t,bitrate:i?i.bitrate:0}),this._loader||(this._loader=new j);var r={url:e,progress:!0,responseType:"arraybuffer",credentials:this._config.credentials};this._loader instanceof j&&this._loader.load(r,this._loaderCallbacks,this._loaderConf)},h._append=function(e,t,i,r,n){this._w?this._w.postMessage({cmd:"append",tags:e,timeOffset:t||0,discontinuity:i,contiguous:r,accurateTimeOffset:n}):this._flv&&this._flv.append(e,t||0,i,r,n)},h._onProgress=function(e,t,i){if(t instanceof ArrayBuffer){this._multirate&&this._multirate.onLoaderChunk(t.byteLength),this.emit(f.a.REPORT,{type:q,byteLength:t.byteLength,timeCost:performance.now()-this._progressTime||i.trequest,header:e.responseHeader}),this._progressTime=performance.now();var r=this._tagDump.append(t);this._append(r.list,this._baseTimeSec,this._discontinuity,this._contiguous,this._accurateTimeOffset),this._accurateTimeOffset=!0,this._contiguous=!0,this._discontinuity=!1,r.abr&&this._load(r.abr.url,r.abr.level)}},h._onAbort=function(){},h._onLoaderError=function(e,t){if(t.fatal){var i={type:d.b.NETWORK_ERROR,details:d.a.LOAD_ERROR,fatal:!0,reason:t.text,statusCode:t.code,url:e.url};this.emit(f.a.ERROR,i)}},h._onLoaderEnd=function(){this._w?this._w.postMessage({cmd:"end"}):this._flv&&this._flv.end()},h._refreshRemuxId=function(){this._remuxId++;var e={remuxId:this._remuxId};this._w?this._w.postMessage({cmd:"setExtra",data:e}):this._flv&&this._flv.setExtra(e)},s=n,(o=[{key:"autoLevelEnabled",get:function(){return!!this._multirate&&this._multirate.autoLevelEnabled}},{key:"levels",get:function(){return this._multirate?this._multirate.levels:[]}},{key:"nextLevel",get:function(){return this._multirate?this._multirate.nextLevel:0},set:function(e){var t=this._multirate;t&&(t.nextLevel=e)}},{key:"currentLevel",get:function(){return this._multirate?this._multirate.currentLevel:0},set:function(e){var t=this._multirate;if(t){var i=e>=0||e!==t.currentLevel;t.currentLevel=e;var r=t.levels[t.currentLevel];i&&r&&(this._currentUrl=S(r.url,this._config.defaultSpts),this._refreshRemuxId(),this._contiguous=!1,this._discontinuity=!0,this._accurateTimeOffset=!1,this._tagDump&&this._tagDump.reset(),this._baseTimeSec=this._media.currentTime,this.emit(f.a.LEVEL_SWITCHING,{level:t.currentLevel,startSec:this._baseTimeSec,smooth:!1}),this._load(this._currentUrl,t.currentLevel))}}}])&&Q(s.prototype,o),u&&Q(s,u),n}(w.a),Z={400:"01",401:"02",403:"03",404:"04",other4xx:"05",serverError:"06",timeoutOpen:"07",timeoutIO:"08",200:"09",206:"09"};var Y=window.performance,J=function(){function e(){this.tag="fps",this._lastDroppedFrames=0,this._lastDecodedFrames=0,this._video=null,this._isVideoPlaybackQualityAvailable=!1,this._lastTime=0,this._decoded=0,this._dropped=0}var t=e.prototype;return t.attachMedia=function(e){var t=this._video=e instanceof window.HTMLVideoElement?e:null;t&&(this._isVideoPlaybackQualityAvailable="function"==typeof t.getVideoPlaybackQuality)},t.destory=function(){},t.reset=function(){this._lastTime=Y.now(),this._lastDroppedFrames=this._lastDecodedFrames=this._decoded=this._dropped=0;var e=this._video;if(e)try{if(this._isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this._lastDecodedFrames=t.totalVideoFrames,this._lastDroppedFrames=t.droppedVideoFrames}else this._lastDecodedFrames=e.webkitDecodedFrameCount,this._lastDroppedFrames=e.webkitDroppedFrameCount}catch(e){return}},t.checkFPSInterval=function(){var e=this._video,t=Y.now(),i=null,r=0,n=0;if(e)if(this._isVideoPlaybackQualityAvailable){var s=e.getVideoPlaybackQuality();r=s.totalVideoFrames,n=s.droppedVideoFrames}else r=e.webkitDecodedFrameCount||0,n=e.webkitDroppedFrameCount||0;if(r){r<this._lastDecodedFrames&&(this._lastDecodedFrames=0,this._lastDroppedFrames=0);var a=t-this._lastTime,o=n-this._lastDroppedFrames,u=r-this._lastDecodedFrames,h=0,d=0;this._lastTime&&(h=parseFloat((1e3*o/a).toFixed(2)),d=parseFloat((1e3*u/a).toFixed(2))),this._decoded=this._decoded+=u,this._dropped=this._dropped+=o,this._lastTime=t,this._lastDroppedFrames=n,this._lastDecodedFrames=r,i={decoded:this._decoded,dropped:this._dropped,decodedFPS:d,droppedFPS:h}}return this._lastTime=t,i},e}();function $(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ee=function(){function e(){this._qos=void 0,this.reset()}var t,i,n,s=e.prototype;return s.reset=function(){this._qos={traffic:0,streams:[],download:[]}},s.onKeyFrame=function(){this._qos.streams[this._qos.streams.length-1].keyFrame++},s.onStreamOpen=function(e,t,i,r){this._qos.streams.length>10&&this._qos.streams.shift(),this._qos.streams.push({index:e,startPos:t,url:i,bitrate:r,traffic:0,loadTimeCost:0,keyFrame:0,videoDataRate:0,audioDataRate:0,segments:{}})},s.onMediaInfo=function(e){var t=this.loadingInfo;t&&(t.mediaInfo=Object(r.a)({},e))},s.onDataReceive=function(e){this._qos.traffic+=e.byteLength;var t=this._qos.download;t.length>200&&t.pop(),t.unshift(e);var i=this._qos.streams[this._qos.streams.length-1];i.traffic+=e.byteLength,i.loadTimeCost+=e.timeCost},s.onMediaSegment=function(e){var t=this._qos,i=t.streams[t.streams.length-1],r=i.segments[e.type]||[];i.segments[e.type]=r,r.push({duration:e.duration,dts:e.dts,len:e.byteLength}),r.length>100&&r.shift();for(var n=0,s=0,a=0;a<r.length;a++)s+=r[a].len,n+=r[a].duration;n>0&&("video"===e.type?i.videoDataRate=Math.round(8*s/n):"audio"===e.type&&(i.audioDataRate=Math.round(8*s/n)))},s.getInfoByTime=function(e){for(var t=this._qos.streams.length-1;t>=0;t--)if(this._qos.streams[t].startPos<e)return this._qos.streams[t];return null},s.updateStartPos=function(e){this._qos.streams.length&&(this._qos.streams[this._qos.streams.length-1].startPos=e)},t=e,(i=[{key:"loadingInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1]:null}},{key:"downloadSpeed",get:function(){for(var e=this._qos,t=performance.now(),i=0,r=0,n=0;n<e.download.length&&e.download[n].ts>t-1e3;n++)i+=e.download[n].byteLength,r+=e.download[n].timeCost;return Math.round(i/r*1e3)||0}},{key:"mediaInfo",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].mediaInfo:null}},{key:"videoDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].videoDataRate:0}},{key:"audioDataRate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].audioDataRate:0}},{key:"bitrate",get:function(){return this._qos.streams.length?this._qos.streams[this._qos.streams.length-1].bitrate:0}},{key:"traffic",get:function(){return this._qos.traffic}},{key:"data",get:function(){return this._qos}}])&&$(t.prototype,i),n&&$(t,n),e}();function te(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var ie=function(e){var t,i;function r(t){var i;return(i=e.call(this)||this)._media=void 0,i._fps=void 0,i._data=void 0,i._playing=!1,i._sm=void 0,i._hbTimer=void 0,i._heartbeat=function(){i._refresh();var e=i._data,t=i._sm,r={totalReceive:t.traffic,speed:t.downloadSpeed,videoDataRate:t.videoDataRate,audioDataRate:t.audioDataRate,decodedFPS:e.decodedFPS,droppedFPS:e.droppedFPS,decodedFrames:e.decodedFrames,droppedFrames:e.droppedFrames};i.emit(f.a.HEARTBEAT,r)},i._sm=new ee,i._media=t,i.reset(),i}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n,s,a,o=r.prototype;return o.reset=function(){this._data={decodedFPS:0,droppedFPS:0,decodedFrames:0,droppedFrames:0,loadStartTime:0,firstFrameTime:0,blockDuration:0,blockCount:0,downloadedBytes:0},this._sm.reset(),this._fps&&this._fps.reset(),this._refresh()},o.onReport=function(e){e.ts=e.ts||performance.now();var t=this._data;switch(e.type){case q:t.downloadedBytes+=e.byteLength,this._sm.onDataReceive(e);break;case z:this._sm.onStreamOpen(e.index||0,e.sync,e.url,e.bitrate);break;case W:this._sm.onKeyFrame()}},o.destroy=function(){this._fps&&(this._fps.destory(),this._fps=void 0),this._stopHeartbeat()},o.onLoad=function(){this._startHeartbeat(),this._media.video&&(this._fps=new J,this._fps.attachMedia(this._media.video))},o.onSegmentInit=function(e){this._sm.onMediaInfo(e)},o.onLoadeddata=function(){this._onFirstFrame(),this._waitingEnd()},o.onCanplay=function(){this._onFirstFrame(),this._waitingEnd()},o.onPlaying=function(){this._playing=!0,this._waitingEnd()},o.onEnd=function(){this._waitingEnd()},o.onWaiting=function(e){this._playing&&this._data.firstFrameTime&&e&&this._waitingStart()},o.onStopLoad=function(){this._stopHeartbeat()},o.onSegment=function(e){this._sm.onMediaSegment(e)},o._refresh=function(){var e;this._fps&&(e=this._fps.checkFPSInterval());var t=this._data;e?(t.decodedFPS=e.decodedFPS,t.droppedFPS=e.droppedFPS,t.droppedFrames=e.dropped,t.decodedFrames=e.decoded):t.decodedFPS=t.droppedFPS=t.droppedFrames=t.decodedFrames=0},o._onFirstFrame=function(){this._data.firstFrameTime||(this._data.firstFrameTime=performance.now())},o._waitingStart=function(){this._data.bufferingStartMS||(this._data.blockCount++,this._data.bufferingStartMS=this._data.bufferingStartMS||performance.now())},o._waitingEnd=function(){this._data.bufferingStartMS&&(this._data.blockDuration+=performance.now()-this._data.bufferingStartMS),this._data.bufferingStartMS=null},o._startHeartbeat=function(){this._hbTimer||(this._hbTimer=setInterval(this._heartbeat,1e3))},o._stopHeartbeat=function(){this._hbTimer&&(clearInterval(this._hbTimer),this._hbTimer=void 0)},n=r,(s=[{key:"data",get:function(){return this._data}}])&&te(n.prototype,s),a&&te(n,a),r}(n.EventEmitter);function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ne(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function se(e,t,i){return t&&ne(e.prototype,t),i&&ne(e,i),e}i.d(t,"default",(function(){return oe}));var ae;!function(e){e[e.NONE=0]="NONE",e[e.WAITING=1]="WAITING",e[e.SEEK=2]="SEEK",e[e.SELECT_BITRATE=3]="SELECT_BITRATE",e[e.INIT=4]="INIT"}(ae||(ae={}));var oe=function(e){var t,i;function n(t){var i;return(i=e.call(this)||this).tag="las",i._config=void 0,i._video=void 0,i._mse=void 0,i._trans=void 0,i._stat=ae.INIT,i._seekOnCanplay=!1,i._audioCodecSwap=!1,i._error=void 0,i._audioCodec="",i._recoverMediaErrorTime=0,i._mainTimer=void 0,i._media=void 0,i._nextLevel=[],i._mediaInfo=void 0,i._bufferThreshold=.5,i._loadStopped=!1,i._seekOnUpdateEnd=!1,i._playingLevel=void 0,i._startLevel=void 0,i._monitor=void 0,i._onVideoPlay=function(){i._error||i._trans||i.load()},i._onVideoEnded=function(){i._monitor.onEnd(),i._mse&&i._mse.flush()},i._resetMSE=function(){i._seekOnUpdateEnd=!1,i._video&&(a.b.i(i.tag,"rebuild mse"),URL.revokeObjectURL(i._video.src),i._video.src="",i._video.removeAttribute("src"),i._destroyMSE(),i._initMSE(i._video))},i._mainLoop=function(){var e=i._video;if(e&&(i._stat===ae.WAITING&&!e.seeking||i._stat===ae.INIT||i._stat===ae.SEEK||i._stat===ae.SELECT_BITRATE)&&i._mse&&!i._mse.hasCleanUpTask()&&!e.ended){var t=e.currentTime,r=i._media.currentBuffer(t),n=void 0;if(!r||r.end-t<1){var o=i._media.nextBuffer(t);o&&(a.b.i(i.tag,"try fix block-A"),n=o.start)}else e.buffered.length>1&&r.end-t>1&&(a.b.i(i.tag,"try fix block-B"),n=r.start);n&&(n+=s.a.safari?.3:.001,i._internalSeek(n),a.b.i(i.tag,"jump to "+n))}i._nextLevel.length&&i._checkLevelChange()},i._onVideoLoadeddata=function(){a.b.i(i.tag,"loadeddata"),i._monitor.onLoadeddata()},i._onVideoCanplay=function(){a.b.v(i.tag,"canplay "+!!i._stat),i._monitor.onCanplay(),i._video&&i._stat!==ae.NONE&&(i._stat=ae.NONE,i._detectSeekOnCanplay(),i._checkLevelChange(),i._video.paused||i._onVideoPlaying())},i._onVideoWaiting=function(){if(i._video){i._stat=i._stat||ae.WAITING;var e=!i._video.seeking&&i._stat===ae.WAITING;e&&(i._bufferThreshold=Math.min(i._bufferThreshold+1,3.5)),e&&a.b.i(i.tag,"waiting currentTime:",i._video.currentTime),i._monitor.onWaiting(e)}},i._onVideoPlaying=function(){a.b.i(i.tag,"playing"),i._error||(i._stat=ae.NONE,i._monitor.onPlaying())},i._onVideoError=function(e){if(a.b.e(i.tag,"video error",e),!i._error){var t=performance.now();if(!i._recoverMediaErrorTime||t-i._recoverMediaErrorTime>3e3)return i._recoverMediaErrorTime=t,i._config.gopRemux=!0,void i._recoverMediaError();if(!i._audioCodecSwap&&i._audioCodec)return i._audioCodecSwap=!0,i._recoverSwapAudioCodec(),void i._recoverMediaError();var r="video error";i._video&&i._video.error&&(r+=" code:"+i._video.error.code+" message:"+i._video.error.message),i._onError({type:d.b.MEDIA_ERROR,details:d.a.VIDEO_ERROR,fatal:!0,reason:r})}},i.off||(i.off=i.removeListener),i._config=h.processConfig(t),i._media=new c,i._config?n.isSupport()?(i._mainTimer=null,i._stat=ae.INIT,i._startMainTimer(),i._initMonitor(),a.b.i(i.tag,n.version,i._config),i):(setTimeout((function(){i._onError({type:d.b.OTHER_ERROR,details:d.a.UNSUPPORTED,fatal:!0,reason:"unsupported"})}),0),re(i)):(setTimeout((function(){i._onError({type:d.b.OTHER_ERROR,details:d.a.CONFIG_ERROR,fatal:!0,reason:"config data error"})}),0),re(i))}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,n.isSupport=function(){return e=l(),t=window.SourceBuffer||window.WebKitSourceBuffer,i=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove,n=N.isSupport()||G.isSupportChunk()===B.MOZ_CHUNK,i&&r&&n;var e,t,i,r,n},se(n,null,[{key:"version",get:function(){return"1.0.2"}},{key:"Events",get:function(){return f.a}},{key:"ErrorTypes",get:function(){return d.b}},{key:"ErrorDetails",get:function(){return d.a}}]);var o=n.prototype;return o.attachMedia=function(e){this._video=e,this._media.attachVideo(this._video),this._initMSE(e),this._bindVideoEvents()},o.load=function(e){void 0===e&&(e=void 0),this._playingLevel=void 0,this._monitor.reset(),e&&h.setSrc(this._config,e),this._config.src||this._config.manifest?this._load():this._onError({type:d.b.OTHER_ERROR,details:d.a.CONFIG_ERROR,fatal:!0,reason:"url empty"})},o.resume=function(){a.b.i(this.tag,"call resume"),this._loadStopped&&(this._loadStopped=!1,this._load()),this._video&&this._video.paused&&this._video.play()},o.destroy=function(){this._stopMonitor(),this._stopMainTimer(),this._unbindVideoEvents(),this._stopVideo()},o.refresh=function(){a.b.i(this.tag,"call refresh"),this._trans&&this._mse&&this._video?(this._startLevel=this._trans.currentLevel,this._nextLevel=[],this._stopVideo(),this._initMSE(this._video),this._initTrans(),this._trans&&this._trans.loadSource()):a.b.v(this.tag,"transmuxer & mediaSource not ready")},o.stopLoad=function(){a.b.i(this.tag,"call stopLoad"),this._trans&&(this._destroyTrans(),this._mse.endOfData(),this._loadStopped=!0,this._monitor.onStopLoad())},o.getMediaInfo=function(){return Object(r.a)({},this._mediaInfo)},o._bindVideoEvents=function(){this._video&&(this._video.addEventListener("loadeddata",this._onVideoLoadeddata),this._video.addEventListener("canplay",this._onVideoCanplay),this._video.addEventListener("waiting",this._onVideoWaiting),this._video.addEventListener("playing",this._onVideoPlaying),this._video.addEventListener("play",this._onVideoPlay),this._video.addEventListener("error",this._onVideoError),this._video.addEventListener("ended",this._onVideoEnded))},o._unbindVideoEvents=function(){this._video&&(this._video.removeEventListener("loadeddata",this._onVideoLoadeddata),this._video.removeEventListener("canplay",this._onVideoCanplay),this._video.removeEventListener("waiting",this._onVideoWaiting),this._video.removeEventListener("playing",this._onVideoPlaying),this._video.removeEventListener("play",this._onVideoPlay),this._video.removeEventListener("error",this._onVideoError),this._video.removeEventListener("ended",this._onVideoEnded))},o._unbindMediaSourceEvent=function(e){e.removeAllListeners()},o._initMSE=function(e){var t=this;this._mse=new v(this._config),this._mse.attach(e),this._media.attachMSE(this._mse),this._mse.on(f.a.ERROR,(function(e){t._onError(e)})),this._mse.on("updateend",(function(){t._seekOnUpdateEnd&&e.buffered.length&&(a.b.i(t.tag,"seek on updateend"),t._internalSeek(e.buffered.start(0)),t._seekOnUpdateEnd=!1)})),this._mse.on("resetDone",(function(){t._seekOnUpdateEnd=!0}))},o._load=function(){this._loadStopped=!1,this._error=!1,this._stat=ae.INIT,this._bufferThreshold=.5,this._nextLevel=[],this._media.reset(),this._monitor.onLoad(),this._trans&&this._destroyTrans(),(this._mse.hasSourceBuffer()||this._video&&this._video.error)&&this._resetMSE(),this._initTrans(),this._trans&&this._trans.loadSource()},o._verifyLevel=function(e){return!(!(this._trans&&this._trans.levels.length>0&&e<this._trans.levels.length&&e>=-1&&this._video)||this._video.ended)},o._transmuxerEvent=function(e){var t=this,i=this._mse;e.on(f.a.PARSING_DATA,(function(e){i&&i.mediaSegment(e),t._monitor&&t._monitor.onSegment({type:e.type,byteLength:e.data.byteLength,dts:Math.floor(1e3*e.startDTS),duration:Math.floor(1e3*e.duration),framesInfo:e.framesInfo})})),e.on(f.a.PARSING_INIT_SEGMENT,(function(e){var n=e.tracks.video,s=e.tracks.audio,a=e.tracks.audiovideo,o={segments:[],audiovideo:!!a,hasVideo:!(!n&&!a),hasAudio:!(!s&&!a)};for(var u in e.tracks){var h=e.tracks[u];Object(r.a)(o,h.metadata),h.initSegment&&o.segments.push({type:u,data:new Uint8Array(h.initSegment)})}o.videoCodec=n?n.codec:null,o.audioCodec=s?s.codec:null,t._audioCodec=e.manifestAudioCodec||o.audioCodec;var d=Object(r.a)({},o);delete d.segments,t._monitor.onSegmentInit(d),t.emit(f.a.MEDIA_INFO,d),t._mediaInfo=d,i&&i.trackInfo(o)})),e.on(f.a.ERROR,(function(e){t._onError(e)})),e.on(f.a.LOAD_END,(function(){i&&i.endOfData(),t.emit(f.a.LOAD_END)})),e.on(f.a.LEVEL_SWITCH_FAILED,(function(e){t.emit(f.a.LEVEL_SWITCH_FAILED,e)})),e.on(f.a.LEVEL_SWITCHING,(function(e){!e.smooth&&t._mse&&t._mse.flush(),t.emit(f.a.LEVEL_SWITCHING,{level:e.level}),t._nextLevel=t._nextLevel.sort((function(e,t){return e.startSec-t.startSec})).filter((function(t){return t.startSec<e.startSec})),t._nextLevel.push(e)})),e.on(f.a.BUFFER_FLUSHING,(function(e){t._mse&&t._video&&t._mse.flush(e.startSec,t._video.duration)})),e.on(f.a.SCRIPT_PARSED,(function(e){t.emit(f.a.SCRIPT_PARSED,e)})),e.on(f.a.MANIFEST_PARSED,(function(i){"number"!=typeof t._playingLevel?("number"==typeof t._startLevel&&(e.currentLevel=t._startLevel),i=Object(r.a)({levels:t.levels.slice(0),currentLevel:t.currentLevel},i),t._playingLevel=e.currentLevel,a.b.i(t.tag,f.a.MANIFEST_PARSED,i),t.emit(f.a.MANIFEST_PARSED,i)):e.currentLevel=t._playingLevel})),e.on(f.a.REPORT,(function(e){t._monitor&&t._monitor.onReport(e)}))},o._internalSeek=function(e){this._video&&(this._video.currentTime=e)},o._detectSeekOnCanplay=function(){if(this._video&&this._seekOnCanplay&&this._mse&&!this._mse.hasCleanUpTask()){var e=1/30,t=this._mediaInfo;t&&t.fps&&t.fps>0&&(e=1/t.fps),this._media.isTimeinBuffered(this._video.currentTime+e)&&(a.b.i(this.tag,"seek on canplay "+this._video.currentTime+" + "+e),this._seekOnCanplay=!1,this._internalSeek(this._video.currentTime+e))}},o._onError=function(e){a.b.i(this.tag,"on error "+JSON.stringify(e));var t={};if(e.type===d.b.NETWORK_ERROR&&(t.statusCode=e.statusCode,t.url=e.url),e.fatal){var i=function(e,t,i){if(void 0===i&&(i=0),e>=100)return e;var r="00";return"timeout"===t?r=i?Z.timeoutIO||r:Z.timeoutOpen||r:Z.hasOwnProperty(i)?r=Z[i]||r:/^4\d{2}$/.test(i.toString())?r=Z.other4xx||r:/^5\d{2}$/.test(i.toString())&&(r=Z.serverError||r),parseInt(e+r,10)}(e.details,e.reason,e.statusCode||0);this.stopLoad(),this._stopMainTimer(),(e.details===d.a.VIDEO_ERROR||this._video&&this._video.error)&&this._destroyMSE(),t.code=i,t.type=e.type,t.reason=e.reason,this._error||(this._error=t,this.emit(f.a.ERROR,t))}},o._startMainTimer=function(){null===this._mainTimer&&(this._mainTimer=setInterval(this._mainLoop,200))},o._stopMainTimer=function(){this._mainTimer&&(clearInterval(this._mainTimer),this._mainTimer=null)},o._checkLevelChange=function(){var e=this._nextLevel[0];this._video&&e&&this._video.currentTime>=e.startSec&&this._media.isTimeinBuffered(this._video.currentTime)&&(this.emit(f.a.LEVEL_SWITCHED,{level:e.level}),this._playingLevel=e.level,this._nextLevel.shift())},o._stopVideo=function(){this._video&&(URL.revokeObjectURL(this._video.src),this._video.src="",this._video.removeAttribute("src"),this._destroyTrans(),this._destroyMSE())},o._destroyTrans=function(){this._trans&&(this._trans.removeAllListeners(),this._trans.destroy(),this._trans=void 0)},o._destroyMSE=function(){this._mse&&(this._unbindMediaSourceEvent(this._mse),this._mse.destroy())},o._initTrans=function(){this._trans=new K(this._config,this._media),this._transmuxerEvent(this._trans),this._trans.init()},o._initMonitor=function(){var e=this;this._monitor||(this._monitor=new ie(this._media),this._monitor.on(f.a.HEARTBEAT,(function(t){e.emit(f.a.HEARTBEAT,t)})))},o._stopMonitor=function(){this._monitor&&(this._monitor.destroy(),this._monitor.removeAllListeners())},o._recoverSwapAudioCodec=function(){var e=this._audioCodec;e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5",this._config.audioCodec=e,this._config.audioCodecSwap=!0},o._recoverMediaError=function(){this._video&&(this._nextLevel=[],this._stopVideo(),this._initMSE(this._video),this._initTrans(),this._trans&&this._trans.loadSource())},se(n,[{key:"autoLevelEnabled",get:function(){return!!this._trans&&this._trans.autoLevelEnabled}},{key:"levels",get:function(){return this._trans?this._trans.levels:[]}},{key:"nextLevel",get:function(){return this._trans?this._trans.nextLevel:0},set:function(e){this._verifyLevel(e)&&this._trans?this._trans.nextLevel=e:this.emit(f.a.LEVEL_SWITCH_FAILED,{level:e})}},{key:"currentLevel",get:function(){return this._trans?this._trans.currentLevel:0},set:function(e){this._verifyLevel(e)&&this._trans?-1===e?this._trans.nextLevel=e:(this._stat=ae.SELECT_BITRATE,this._bufferThreshold=.5,this._seekOnCanplay=!0,this._mse&&this._mse.flush(),this._trans.currentLevel=e):this.emit(f.a.LEVEL_SWITCH_FAILED,{level:e})}},{key:"startLevel",get:function(){return void 0===this._startLevel?-1:this._startLevel},set:function(e){this._startLevel=e}},{key:"monitorData",get:function(){if(this._monitor)return this._monitor.data}}]),n}(n.EventEmitter)}]).default}));
//# sourceMappingURL=index.min.js.map